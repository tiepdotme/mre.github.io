

<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      html,body,div,form,fieldset,legend,label,h1,h2{margin:0;padding:0}body{font-family:"Book Antiqua","Palatino Linotype",Palatino,"EB Garamond",serif;font-size:1.2em;line-height:1.58;color:#111;border-top:0.5em solid #c35}.container{display:grid;grid-template-columns:auto;margin:0 auto}header{font-size:0.8em;text-align:center;padding-top:30px}.bio{width:210px;margin:auto;padding:16px}main{padding:5px;margin-bottom:50px;max-width:650px}main article{margin-bottom:44px}main img,main video,iframe{max-width:100%;height:auto}.homepage h1{font-size:130%}h1,h2,h3,h4,h5,h6,th,td,caption{font-weight:400}h1{font-size:1.87em;margin-bottom:8px}h2{font-size:1.2em}main h2{margin-top:60px}h3{margin-top:0px;font-style:italic}header nav ul{display:inline-block;padding-left:0px;margin-top:0}header nav li{list-style:none;display:inline}.post-meta{font-style:italic;margin:0px;font-size:90%}.homepage .post-meta{font-size:80%}.btn{color:#111;background-color:#fafafa;display:inline-block;font-weight:500;border-radius:6px;border:1px solid rgba(27,31,35,0.15);text-decoration:none;box-shadow:0 1px 0 rgba(27,31,35,0.04),inset 0 1px 0 rgba(255,255,255,0.25);transition:background-color 0.2s cubic-bezier(0.3, 0, 0.5, 1);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;padding:5px 16px;white-space:nowrap}.btn-sm{padding:3px 12px;font-size:15px;line-height:20px}.btn-ico{margin-right:4px;vertical-align:text-bottom;transition:transform 0.15s cubic-bezier(0.2, 0, 0.13, 2);transform:scale(1);color:#ff1c76;fill:currentColor}.btn:hover .btn-ico{transform:scale(1.1)}pre,code{font-family:operator mono,sfmono-regular,Consolas,liberation mono,Menlo,Courier,monospace}pre{display:inline-grid;border-radius:6px;width:100%;padding:5px 0}code{font-size:0.8em;padding:2px}pre>code{overflow-x:auto;display:inline-block}:not(pre)>code{color:#111;background:#fafafa;border-radius:6px;box-shadow:0 1px 1px rgba(0,0,0,0.125)}blockquote{border-left:4px solid #9fd6fa;font-style:italic;margin:4px 10px;padding:0px 20px}::selection{background:black;color:white}a{color:#111;text-decoration:underline;text-decoration-color:#c35;text-decoration-thickness:2px;transition:text-decoration-color 200ms}a:hover{text-decoration-color:#111}.icon{height:24px;width:24px;opacity:0.4;float:left;margin:5px;background-repeat:no-repeat}.icon:hover{opacity:1;transition:opacity 200ms ease-in}figure{font-size:0.9em;font-style:italic;margin:40px 0 40px;padding:0;text-align:center;text-indent:0}figcaption{margin-top:10px}.post-links{list-style:none;padding:0}.comments{list-style:none;display:inline}#teaser{background:#c35;color:#f5b2c8}#teaser a,footer a{color:white}#teaser a::after{content:"\a0»"}footer{background:#234;color:#b9b9b9}#teaser,footer{display:flex;justify-content:center}#teaser .body,footer .body{max-width:800px;margin:40px auto;padding:20px}.field{padding:10px;font-size:0.8em;border:none;border:1px solid #b9b9b9}.autocomplete{position:relative;display:inline-block}.autocomplete input{border:1px solid #ddd;padding:10px 20px;border-radius:20px;width:150px;font-size:0.9em;box-shadow:0 1px 0px rgba(255,255,255,0.25)}input[type="submit"]{cursor:pointer;background-color:#b9b9b9}input:focus::placeholder{color:transparent}.autocomplete-items{position:absolute;left:0;top:38px;font-size:0.9em;line-height:1.5;width:100%}.autocomplete-items div{padding:10px;cursor:pointer;background-color:white;border:1px solid #ddd}.autocomplete-items div:hover,.autocomplete-active{background-color:#c35 !important;color:white}@media screen and (min-width: 600px){.container{justify-content:center;margin-top:40px;grid-template-columns:auto auto}header{position:sticky;top:0;height:100vh;box-sizing:border-box}main{padding:0px 30px;margin-top:20px}pre{padding:10px}.bio span:after{content:"Writes about Rust, engineering culture, and socks."}}@media not screen and (max-width: 800px){.searchicon{display:none}}@media screen and (max-width: 800px){#searchbox{display:none}#searchbox:target{display:block}.autocomplete{width:100%;font-size:1.1em}.autocomplete input{width:calc(100% - 100px);margin:20px 10px}.autocomplete-items{top:58px}}.info{padding:20px;margin:30px 0;background-color:lightyellow;border:4px solid peachpuff;position:relative;border-radius:6px}.logo_font{position:relative;width:165px;height:34px;margin:0 auto}.logo_font svg{position:absolute;top:0;left:0}@media (prefers-color-scheme: light){.logo_font_dark{display:none}}@media (prefers-color-scheme: dark){.logo_font_light{display:none}}@media (prefers-color-scheme: dark){body{background:#234;color:white;border-top:0.5em solid #ff1c76}.bio,.post-meta{color:#b9b9b9}a{color:white;text-decoration-color:#ff1c76}a:hover{text-decoration-color:white}.icon{filter:brightness(0) invert(1)}main img{background-color:white;border-radius:6px}table{width:100%}table a{border:none}th,td{border-bottom:1px solid #ddd}pre,code{-webkit-filter:invert(100%);filter:invert(100%)}.info{background:#141f2b;border-color:#555}.btn{background:#111;color:white}.autocomplete input,.autocomplete-items div{border:0;background:#141f2b;color:white}footer{background:#141f2b}}

    </style>
<title>A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly | Matthias Endler</title>
<link rel="canonical" href="https://endler.dev/2019/tinysearch/">

<meta property="og:title" content="A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly | Matthias Endler" />
<meta property="og:type" content="website" />
<meta property="og:description" content="
  I wrote a basic search module…" />
<meta property="og:url" content="https://endler.dev/2019/tinysearch/" />
<meta property="og:image" content="https://endler.dev/default.png" />

<meta name="twitter:title" content="A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly">
<meta name="twitter:description" content="
  I wrote a basic search module…">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@matthiasendler">
<meta name="twitter:creator" content="@matthiasendler">
<meta name="twitter:image" content="https://endler.dev/default.png">
    <link rel="canonical" href="https://endler.dev/2019/tinysearch/" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/apple-touch-icon.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon-32x32.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon-16x16.png?v=m2llJQPQq8"
    />
    <link
      rel="mask-icon"
      href="/safari-pinned-tab.svg?v=m2llJQPQq8"
      color="#5bbad5"
    />
    <link rel="shortcut icon" href="/favicon.ico?v=m2llJQPQq8" />
    <link href="/rss.xml" rel="alternate" type="application/rss+xml" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="author" content="Matthias Endler" />
    <meta
      name="description"
      content="Personal website of Matthias Endler, a Software Engineer interested in low-level programming and Backend development. Rust, Go"
    />
  </head>

  <body>
    <div class="container">
      <header>
        



<a href="/" aria-label="Go back to homepage">
  
  
  <div class="logo" style="width: 110px; margin: auto;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 456 456"><defs/><g letter-spacing="0" transform="translate(-167)" word-spacing="0"><circle cx="395" cy="228" r="220" fill="#fff" stroke="#000" stroke-width="16"/><path fill="#856800" fill-rule="evenodd" d="M468 266l-70 37-77-37z"/><path fill="#ffcb15" fill-rule="evenodd" d="M468 266l-70 31-77-31z"/><path d="M360 208a22 21 85 00-2 0 22 21 85 00-19 24 22 21 85 0023 19 22 21 85 0019-23 22 21 85 00-7-14 5 6 0 012 4 5 6 0 01-6 7 5 6 0 01-5-7 5 6 0 016-6 5 6 0 013 1 22 21 85 00-14-5zm71 1a22 21 85 00-2 0 22 21 85 00-19 23 22 21 85 0022 20 22 21 85 0019-24 22 21 85 00-20-19zm10 4a5 6 0 015 6 5 6 0 01-5 6 5 6 0 01-5-6 5 6 0 015-6z"/></g><path fill-rule="evenodd" d="M262 58c-4 9-12 19-19 24 1-8 2-16 1-22-4 8-12 18-20 24 2-7 2-15 1-21-7 13-15 24-29 28-70 20-131 113-152 213 11 28 29 53 51 73 8-158 45-267 112-208 10 9 16 13 20 13 5 0 10-4 21-13 67-59 105 50 112 208 22-20 40-45 51-73-20-95-77-184-144-209l-10-4c4-8 7-23 5-33z"/></svg>
  </div>
  <div class="logo_font">
    <div class="logo_font_dark">
    <?xml version="1.0" encoding="UTF-8"?>
<svg class="logo_font_dark" version="1.1" viewBox="0 0 786 139" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="m69.2 12.8v112h48.6v-12.2h-36v-31.8h29.8v-12.2h-29.8v-43.2h36v-12.2z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m213 12.8h-12.6v112h12.6c31 0 56.3-24.6 56.3-55.7 0-31.2-25.3-55.8-56.3-55.8zm0 12.2c24.2 0 43.7 19.5 43.7 43.7 0 24-19.5 43.5-43.7 43.5z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m279 12.8v112h48.6v-12.2h-36v-99.4z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m398 12.8v112h12.6v-28c4.96 0 10.1 0.16 15-0.64l19.2 28.6h14.9l-22.7-32.3c13.8-6.56 22.7-20.2 22.7-37.4 0-24.3-18.1-41.8-42.2-41.8zm12.6 71.4v-59.2h6.88c13.9 0 29.6 9.28 29.6 29.6 0 20.3-15.4 29.6-29.6 29.6z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m338 12.8v112h48.6v-12.2h-36v-31.8h29.8v-12.2h-29.8v-43.2h36v-12.2z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m191 13.4h-11.7v73.3l-48.5-73v113h11.8v-71.6l48.4 71.7z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g><g fill="#9f9f9f"><path d="m481 106c-4.79 0-8.7 3.9-8.7 8.7 0 4.79 3.9 8.7 8.7 8.7s8.7-3.9 8.7-8.7-3.9-8.7-8.7-8.7z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m502 12.7v110h14c30.9 0 55.7-24.3 55.7-55.2 0-30.7-24.8-55-55.7-55zm14 96.7v-83.2c23.1 0 41.7 18.6 41.7 41.5 0 23.1-18.6 41.7-41.7 41.7z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m643 12.7 37.1 111 37.1-111h-14.2l-22.9 69.4-23.1-69.4z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m583 13.1v111h48.4v-12.1h-35.8v-31.7h29.6v-12.1h-29.6v-43h35.8v-12.1z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g></svg>

    </div>
    <div class="logo_font_light">
    <?xml version="1.0" encoding="UTF-8"?>
<svg class="logo_font_light" version="1.1" viewBox="0 0 786.1 139.2" xmlns="http://www.w3.org/2000/svg"><g><path d="m69.212 12.818v111.53h48.644v-12.161h-36.003v-31.843h29.762v-12.161h-29.762v-43.203h36.003v-12.161z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m212.8 12.818h-12.641v111.53h12.641c31.042 0 56.324-24.642 56.324-55.684 0-31.203-25.282-55.845-56.324-55.845zm0 12.161c24.162 0 43.684 19.522 43.684 43.683 0 24.002-19.522 43.523-43.684 43.523z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m278.6 12.818v111.53h48.644v-12.161h-36.003v-99.368z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m397.99 12.818v111.53h12.641v-28.002c4.9603 0 10.081 0.15998 15.041-0.64l19.201 28.642h14.881l-22.722-32.323c13.761-6.5605 22.722-20.162 22.722-37.443 0-24.322-18.081-41.763-42.243-41.763zm12.641 71.366v-59.205h6.8805c13.921 0 29.602 9.2807 29.602 29.602 0 20.322-15.361 29.602-29.602 29.602z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m338.3 12.818v111.53h48.644v-12.161h-36.003v-31.843h29.762v-12.161h-29.762v-43.203h36.003v-12.161z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m190.51 13.387h-11.663v73.276l-48.474-72.993v112.67h11.784v-71.581l48.352 71.722z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g><g fill="#9f9f9f"><path d="m480.93 105.53c-4.7912 0-8.6953 3.904-8.6953 8.6953 0 4.7912 3.904 8.6953 8.6953 8.6953 4.7913 0 8.6953-3.904 8.6953-8.6953 0-4.7913-3.904-8.6953-8.6953-8.6953z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m502.04 12.723v110.2h14.019c30.877 0 55.721-24.311 55.721-55.189 0-30.7-24.844-55.011-55.721-55.011zm14.019 96.713v-83.226c23.069 0 41.702 18.633 41.702 41.524 0 23.069-18.633 41.702-41.702 41.702z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m642.71 12.723 37.088 110.73 37.088-110.73h-14.196l-22.892 69.385-23.069-69.385z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m582.92 13.066v110.99h48.407v-12.102h-35.828v-31.688h29.618v-12.102h-29.618v-42.993h35.828v-12.102z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g></svg>

    </div>
  </div>
</a>

        <p class="bio">
          <span>
            Open-source maintainer, speaker, rebel.
          </span>
          <a href="/about">About me.</a>
        </p>
        





<nav>
    <ul>
        <li>
            <a class="icon" href="/" title="Go to homepage" aria-label="Go to homepage">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 61 58'><path stroke='#fff' stroke-linecap='square' stroke-width='.52916' d='M7 21v36h16V38h15v19h15V21z'/><path d='M61 26H0l15-13L30 0l15 13z'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://github.com/mre" title="Github" aria-label="Github">
                <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 578.3 578.3'><path d='M533 160c1-26-5-53-10-79-1-9-5-18-8-27-2-6-10-10-16-9l-12 3c-39 13-76 32-111 54-5 3-11 4-17 3l-41-5c-33-1-67 0-100 6-5 1-11 0-15-3-38-24-77-46-122-57-7-2-14-1-15 1l-3 6c-5 16-10 33-13 51-4 20-7 42-5 62 1 13-3 21-10 30-24 31-34 66-35 104-1 33 4 65 14 97 15 48 45 84 90 108 36 19 76 27 117 28h111c37 1 73-3 109-14 35-12 66-30 90-60 34-42 45-92 47-145 2-40-6-78-30-111a65 65 0 01-15-43zm-71 310c-16 13-35 20-55 25-39 9-79 11-119 10-39 1-78-1-116-10-28-7-54-18-72-42-29-39-36-112 11-152 12-11 26-17 41-18l53-3 133 3c20 0 40-5 60-4 18 2 38 5 54 12 28 12 42 37 47 66 7 43-2 83-37 113z'/><ellipse cx='390' cy='385.6' rx='42.1' ry='56.3'/><ellipse cx='189' cy='385.6' rx='42.1' ry='56.3'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://twitter.com/matthiasendler" title="Twitter"
                aria-label="Twitter">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 612 612'><path fill='#010002' d='M612 116c-23 10-47 17-72 20 26-15 46-40 55-69-24 14-51 24-80 30a125 125 0 0 0-217 86c0 10 1 19 3 29-104-6-196-56-258-132a125 125 0 0 0 39 168c-21-1-40-6-57-16v2c0 61 43 111 100 123a127 127 0 0 1-56 2c16 50 62 86 117 87A252 252 0 0 1 0 498a355 355 0 0 0 550-301l-1-16c25-17 46-40 63-65z'/></svg> 
            </a>
        </li>
        <li>
            <a class="icon" href="/rss.xml" title="RSS feed"
                aria-label="RSS feed"><svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 1280 1280'><path d='M264 224l-1 79v79h8a660 660 0 0 1 438 174 665 665 0 0 1 218 492h156l1-26a820 820 0 0 0-715-792c-37-5-103-9-105-6z'/><path d='M263 504l-1 78 1 79 14 2a383 383 0 0 1 369 368l1 17h158v-19a536 536 0 0 0-98-293 546 546 0 0 0-444-232zM353 830a110 110 0 0 0-77 160 110 110 0 1 0 188-114c-5-7-23-25-30-29-25-16-54-22-81-17z'/></svg></a>
        </li>
        <li>
            <a class="searchicon icon" href="#searchbox" title="Search"
                aria-label="Search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90.1 90.1"><defs/><path d="M71.8 62.6a39.6 39.6 0 10-9.2 9.2L79 88.2a6.5 6.5 0 009.2-9.2zM13 39.6a26.5 26.5 0 1126.5 26.5 26.5 26.5 0 01-26.5-26.5z"/></svg>
            </a>
        </li>
    </ul>
</nav> 
<script type="module">async function lazyLoad(){await init("/tinysearch_engine_bg.wasm")}var loaded=!1;function autocomplete(e){var t;function n(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),t>=e.length&&(t=0),t<0&&(t=e.length-1),e[t].classList.add("autocomplete-active")}function a(t){for(var n=document.getElementsByClassName("autocomplete-items"),a=0;a<n.length;a++)t!=n[a]&&t!=e&&n[a].parentNode.removeChild(n[a])}e.addEventListener("click",(function(e){loaded||(lazyLoad(),loaded=!0)})),e.addEventListener("input",(function(e){var n,o,i,c=this.value;if(a(),!c)return!1;t=-1,(n=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),n.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(n);let r=search(c,3);for(i=0;i<r.length;i++){let e=r[i];(o=document.createElement("DIV")).innerHTML=e[0],o.addEventListener("click",(function(t){window.location.href=`${e[1]}?q=${encodeURIComponent(c)}`})),n.appendChild(o)}})),e.addEventListener("keydown",(function(e){var a=document.getElementById(this.id+"autocomplete-list");a&&(a=a.getElementsByTagName("div")),40==e.keyCode?(t++,n(a)):38==e.keyCode?(t--,n(a)):13==e.keyCode&&(e.preventDefault(),t>-1&&a&&a[t].click())})),document.addEventListener("click",(function(e){a(e.target)}))}let wasm;autocomplete(document.getElementById("tinysearch"));let WASM_VECTOR_LEN=0,cachedTextEncoder=new TextEncoder("utf-8");const encodeString="function"==typeof cachedTextEncoder.encodeInto?function(e,t){return cachedTextEncoder.encodeInto(e,t)}:function(e,t){const n=cachedTextEncoder.encode(e);return t.set(n),{read:e.length,written:n.length}};let cachegetUint8Memory=null;function getUint8Memory(){return null!==cachegetUint8Memory&&cachegetUint8Memory.buffer===wasm.memory.buffer||(cachegetUint8Memory=new Uint8Array(wasm.memory.buffer)),cachegetUint8Memory}function passStringToWasm(e){let t=e.length,n=wasm.__wbindgen_malloc(t);const a=getUint8Memory();let o=0;for(;o<t;o++){const t=e.charCodeAt(o);if(t>127)break;a[n+o]=t}if(o!==t){0!==o&&(e=e.slice(o)),n=wasm.__wbindgen_realloc(n,t,t=o+3*e.length);const a=getUint8Memory().subarray(n+o,n+t);o+=encodeString(e,a).written}return WASM_VECTOR_LEN=o,n}const heap=new Array(32);function getObject(e){return heap[e]}heap.fill(void 0),heap.push(void 0,null,!0,!1);let heap_next=heap.length;function dropObject(e){e<36||(heap[e]=heap_next,heap_next=e)}function takeObject(e){const t=getObject(e);return dropObject(e),t}export function search(e,t){return takeObject(wasm.search(passStringToWasm(e),WASM_VECTOR_LEN,t))}let cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});function getStringFromWasm(e,t){return cachedTextDecoder.decode(getUint8Memory().subarray(e,e+t))}function addHeapObject(e){heap_next===heap.length&&heap.push(heap.length+1);const t=heap_next;return heap_next=heap[t],heap[t]=e,t}function init(e){let t;void 0===e&&(e=import.meta.url.replace(/\.js$/,"_bg.wasm"));const n={wbg:{}};if(n.wbg.__wbindgen_json_parse=function(e,t){return addHeapObject(JSON.parse(getStringFromWasm(e,t)))},"function"==typeof URL&&e instanceof URL||"string"==typeof e||"function"==typeof Request&&e instanceof Request){const a=fetch(e);t="function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,n).catch(e=>a.then(t=>{if("application/wasm"!=t.headers.get("Content-Type"))return console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e),t.arrayBuffer();throw e}).then(e=>WebAssembly.instantiate(e,n))):a.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,n))}else t=WebAssembly.instantiate(e,n).then(t=>t instanceof WebAssembly.Instance?{instance:t,module:e}:t);return t.then(({instance:e,module:t})=>(wasm=e.exports,init.__wbindgen_wasm_module=t,wasm))}export default init;</script>
<form id="searchbox" autocomplete="off">
    <div class="autocomplete">
        <input id="tinysearch" type="text" aria-label="Search through articles" placeholder="&#x1F50D; Search">
    </div>
</form>
      </header>

      <main>
        
<article>
  <p class='post-meta'>Published on 





17th of October, 2019


  </p>
  <h1>A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly</h1>
  
  <div class="info">
  I wrote a basic search module that you can add to a static website.
It's very lightweight (50kB-100kB gzipped) and should work with Hugo, Zola, and
Jekyll. Only searching for entire words is supported. Try the search box on the
left for a demo. <a href="https://github.com/mre/tinysearch">The code is on Github</a>.
</div>
<p>Static site generators are magical. They combine the best of both worlds:
dynamic content without sacrificing performance.</p>
<p>Over the years, this blog has been running on <a href="https://github.com/mre/mre.github.io.v1">Jekyll</a>, <a href="https://github.com/mre/mre.github.io.v2">Cobalt</a>, and, lately,
<a href="https://www.getzola.org/">Zola</a>.</p>
<p>One thing I always disliked, however, was the fact that static websites don't
come with &quot;static&quot; search engines, too. Instead, people resort to <a href="https://cse.google.com/about">custom Google
searches</a>, external search engines like <a href="https://www.algolia.com/">Algolia</a>, or pure
JavaScript-based solutions like <a href="https://lunrjs.com/">lunr.js</a> or <a href="http://elasticlunr.com/">elasticlunr</a>.</p>
<p>All of these work fine for most sites, but it never felt like the final answer.</p>
<p>I didn't want to add yet another dependency on Google; neither did I want to use
a stand-alone web-backend like Algolia, which adds latency and is proprietary.</p>
<p>On the other side, I'm not a huge fan of JavaScript-heavy websites. For example,
just the search indices that lunr creates can be <a href="https://github.com/olivernn/lunr.js/issues/268#issuecomment-304490937">multiple megabytes
in size</a>.
That feels lavish - even by today's bandwidth standards. On top of that,
<a href="https://v8.dev/blog/cost-of-javascript-2019">parsing JavaScript is still
time-consuming</a>.</p>
<p>I wanted some simple, lean, and self-contained search, that could be deployed
next to my other static content.</p>
<p>As a consequence, I refrained from adding search functionality to my blog at
all. That's unfortunate because, with a growing number of articles, it gets
harder and harder to find relevant content.</p>
<h2 id="the-idea">The Idea</h2>
<p>Many years ago, in 2013, I read <a href="https://www.stavros.io/posts/bloom-filter-search-engine/">&quot;Writing a full-text search engine using Bloom
filters&quot;</a> — and it was a revelation.</p>
<p>The idea was simple: Let's run all articles through a generator that creates a
tiny, self-contained search index using this magical data structure called a
✨<em>Bloom Filter</em> ✨.</p>
<h2 id="what-s-a-bloom-filter">What's a Bloom Filter?</h2>
<p>Roughly speaking, a <a href="https://en.wikipedia.org/wiki/Bloom_filter">Bloom filter</a> is a space-efficient way to
check if an element is in a set.</p>
<p>The trick is that it doesn't store the elements themselves; it just knows with
some confidence that they were stored before. In our case, it can say with a
certain <em>error rate</em> that a word is in an article.</p>
<figure>
        <img src=".&#x2F;bloomfilter.svg" 
        loading="lazy"
            alt="A Bloom filter stores a
'fingerprint' (a number of hash values) of all input values instead of the raw
input. The result is a low-memory-footprint data structure. This is an example
of 'hello' as an input."
        />
    <figcaption>
        A Bloom filter stores a
'fingerprint' (a number of hash values) of all input values instead of the raw
input. The result is a low-memory-footprint data structure. This is an example
of 'hello' as an input.
    </figcaption>
</figure>
<p>Here's the Python code from the original article that generates the Bloom
filters for each post (courtesy of <a href="https://www.stavros.io">Stavros
Korokithakis</a>):</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">filters </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">{}
</span><span style="color:#fa6e32;">for </span><span style="color:#61676c;">name</span><span style="color:#61676ccc;">, </span><span style="color:#61676c;">words </span><span style="color:#fa6e32;">in </span><span style="color:#61676c;">split_posts</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">items</span><span style="color:#61676c;">():
  filters[name] </span><span style="color:#ed9366;">= </span><span style="color:#f29718;">BloomFilter</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">capacity</span><span style="color:#ed9366;">=</span><span style="color:#f07171;">len</span><span style="color:#61676c;">(words)</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">error_rate</span><span style="color:#ed9366;">=</span><span style="color:#ff8f40;">0</span><span style="color:#61676ccc;">.</span><span style="color:#ff8f40;">1</span><span style="color:#61676c;">)
  </span><span style="color:#fa6e32;">for </span><span style="color:#61676c;">word </span><span style="color:#fa6e32;">in </span><span style="color:#61676c;">words:
    filters[name]</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">add</span><span style="color:#61676c;">(word)
</span></code></pre>
<p>The memory footprint is extremely small, thanks to <code>error_rate</code>, which allows
for a negligible number of false positives.</p>
<p>I immediately knew that I wanted something like this for my homepage. My idea
was to directly ship the Bloom filters and the search engine to the browser. I
could finally have a small, static search without the need for a backend!</p>
<h2 id="headaches">Headaches</h2>
<p>The disillusionment came quickly.</p>
<p>I had no idea how to bundle and minimize the generated Bloom filters, let alone
run them on clients. The original article briefly touches on this:</p>
<blockquote>
<p>You need to implement a Bloom filter algorithm on the client-side. This will
probably not be much longer than the inverted index search algorithm, but it’s
still probably a bit more complicated.</p>
</blockquote>
<p>I didn't feel confident enough in my JavaScript skills to pull this off. Back in
2013, NPM was a mere three years old, and WebPack just turned one, so I also
didn't know where to look for existing solutions.</p>
<p>Unsure what to do next, my idea remained a pipe dream.</p>
<h2 id="a-new-hope">A New Hope</h2>
<p>Five years later, in 2018, the web had become a different place. Bundlers were
ubiquitous, and the Node ecosystem was flourishing. One thing, in particular,
revived my dreams about the tiny static search engine: <a href="https://webassembly.org/">webassembly</a>.</p>
<blockquote>
<p>WebAssembly (abbreviated Wasm) is a binary instruction format for a
stack-based virtual machine. Wasm is designed as a portable target for
compilation of high-level languages like C/C++/Rust, enabling deployment on
the web for client and server applications. [<a href="https://webassembly.org/">source</a>]</p>
</blockquote>
<p>This meant that I could use a language that I was familiar with to write the
client-side code — Rust! 🎉</p>
<p>My journey started with a <a href="https://github.com/mre/tinysearch/commit/82c1d36835348718f04c9ca0dd2c1ebf8b19a312">prototype back in January
2018</a>.
It was just a direct port of the Python version from above:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#fa6e32;">let mut</span><span style="color:#61676c;"> filters </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">HashMap</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new()</span><span style="color:#61676ccc;">;
</span><span style="color:#fa6e32;">for </span><span style="color:#61676c;">(name</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> words) </span><span style="color:#ed9366;">in</span><span style="color:#61676c;"> articles {
  </span><span style="color:#fa6e32;">let mut</span><span style="color:#61676c;"> filter </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">BloomFilter</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">with_rate(</span><span style="color:#ff8f40;">0.1</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> words</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">len</span><span style="color:#61676c;">() </span><span style="color:#ed9366;">as </span><span style="color:#fa6e32;">u32</span><span style="color:#61676c;">)</span><span style="color:#61676ccc;">;
  </span><span style="color:#fa6e32;">for</span><span style="color:#61676c;"> word </span><span style="color:#ed9366;">in</span><span style="color:#61676c;"> words {
    filter</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">insert</span><span style="color:#61676c;">(</span><span style="color:#ed9366;">&amp;</span><span style="color:#61676c;">word)</span><span style="color:#61676ccc;">;
  </span><span style="color:#61676c;">}
  filters</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">insert</span><span style="color:#61676c;">(name</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> filter)</span><span style="color:#61676ccc;">;
</span><span style="color:#61676c;">}
</span></code></pre>
<p>While I managed to create the Bloom filters for every article, I <em>still</em> had no
clue how I should package that up for the web... until <a href="https://github.com/rustwasm/wasm-pack/commit/125431f97eecb6f3ca5122f8b345ba5b7eee94c7">wasm-pack came along in
February
2018</a>.</p>
<h2 id="whoops-i-shipped-some-rust-code-to-your-browser">Whoops! I Shipped Some Rust Code To Your Browser.</h2>
<p>Now I had all the pieces of the puzzle:</p>
<ul>
<li>Rust - A language I was comfortable with</li>
<li><a href="https://github.com/rustwasm/wasm-pack">wasm-pack</a> - A bundler for WebAssembly modules</li>
<li>A working prototype that served as a proof-of-concept</li>
</ul>
<p>The search box you see at the top of this page is the outcome. It fully runs on Rust using
WebAssembly (a.k.a the <a href="https://twitter.com/timClicks/status/1181822319620063237">RAW stack</a>). Try it now if you like.</p>
<p>There were quite a few obstacles along the way.</p>
<h2 id="bloom-filter-crates">Bloom Filter Crates</h2>
<p>I looked into a few Rust libraries (crates) that implement Bloom filters.</p>
<p>First, I tried jedisct1's
<a href="https://github.com/jedisct1/rust-bloom-filter">rust-bloom-filter</a>, but the types
didn't implement
<a href="https://docs.serde.rs/serde/trait.Serialize.html">Serialize</a>/<a href="https://docs.serde.rs/serde/trait.Deserialize.html">Deserialize</a>.
This meant that I could not store my generated Bloom filters inside the binary and load
them from the client-side.</p>
<p>After trying a few others, I found the
<a href="https://github.com/seiflotfy/rust-cuckoofilter">cuckoofilter</a> crate, which
supported serialization. The behavior is similar to Bloom filters, but if you're
interested in the differences, you can look at <a href="https://brilliant.org/wiki/cuckoo-filter/">this
summary</a>.</p>
<p>Here's how to use it:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#fa6e32;">let mut</span><span style="color:#61676c;"> cf </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">cuckoofilter</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new()</span><span style="color:#61676ccc;">;

</span><span style="font-style:italic;color:#abb0b6;">// Add data to the filter
</span><span style="color:#fa6e32;">let</span><span style="color:#61676c;"> value</span><span style="color:#61676ccc;">: </span><span style="color:#ed9366;">&amp;</span><span style="color:#fa6e32;">str </span><span style="color:#ed9366;">= </span><span style="color:#86b300;">&quot;hello world&quot;</span><span style="color:#61676ccc;">;
</span><span style="color:#fa6e32;">let</span><span style="color:#61676c;"> success </span><span style="color:#ed9366;">=</span><span style="color:#61676c;"> cf</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">add</span><span style="color:#61676c;">(value)</span><span style="color:#ed9366;">?</span><span style="color:#61676ccc;">;

</span><span style="font-style:italic;color:#abb0b6;">// Lookup if data was added before
</span><span style="color:#fa6e32;">let</span><span style="color:#61676c;"> success </span><span style="color:#ed9366;">=</span><span style="color:#61676c;"> cf</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">contains</span><span style="color:#61676c;">(value)</span><span style="color:#61676ccc;">;
</span><span style="font-style:italic;color:#abb0b6;">// success ==&gt; true
</span></code></pre>
<p>Let's check the output size when bundling the filters for ten articles on my blog using cuckoo filters:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">~/C/p/tinysearch ❯❯❯ l storage
Permissions Size User    Date Modified Name
.rw-r--r--   44k mendler 24 Mar 15:42  storage
</span></code></pre>
<p><strong>44kB</strong> doesn't sound too shabby, but these are just the cuckoo filters for ten
articles, serialized as a Rust binary. On top of that, we have to add the search
functionality and the helper code. In total, the client-side code weighed in at
<strong>216kB</strong> using vanilla wasm-pack. Too much.</p>
<h2 id="trimming-binary-size">Trimming Binary Size</h2>
<p>After the sobering first result of 216kB for our initial prototype, we have a
few options to bring the binary size down.</p>
<p>The first is following <a href="https://github.com/johnthagen">johnthagen's</a> advice on
<a href="https://github.com/johnthagen/min-sized-rust">minimizing Rust binary size</a>.</p>
<p>By setting a few options in our <code>Cargo.toml</code>, we can shave off quite a few bytes:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">&quot;opt-level = &#39;z&#39;&quot; =&gt; 249665 bytes
&quot;lto = true&quot;      =&gt; 202516 bytes
&quot;opt-level = &#39;s&#39;&quot; =&gt; 195950 bytes
</span></code></pre>
<p>Setting <code>opt-level</code> to <code>s</code> means we trade size for speed,
but we're preliminarily interested in minimal size anyway. After all, a small download size also improves performance.</p>
<p>Next, we can try <a href="https://github.com/rustwasm/wee_alloc">wee_alloc</a>, an alternative Rust allocator
producing a small <code>.wasm</code> code size.</p>
<blockquote>
<p>It is geared towards code that makes a handful of initial dynamically sized allocations, and then performs its heavy lifting without any further allocations. This scenario requires some allocator to exist, but we are more than happy to trade allocation performance for small code size.</p>
</blockquote>
<p>Exactly what we want. Let's try!</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">&quot;wee_alloc and nightly&quot; =&gt; 187560 bytes
</span></code></pre>
<p>We shaved off another 4% from our binary.</p>
<p>Out of curiosity, I tried to set <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html#codegen-units">codegen-units</a> to 1, meaning we only use a single thread for code generation. Surprisingly, this resulted in a slightly smaller binary size.</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">&quot;codegen-units = 1&quot; =&gt; 183294 bytes
</span></code></pre>
<p>Then I got word of a Wasm optimizer called <code>binaryen</code>.
On macOS, it's available through homebrew:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">brew install binaryen
</span></code></pre>
<p>It ships a binary called <code>wasm-opt</code> and that shaved off another 15%:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">&quot;wasm-opt -Oz&quot; =&gt; 154413 bytes
</span></code></pre>
<p>Then I removed web-sys as we don't have to bind to the DOM: 152858 bytes.</p>
<p>There's a tool called <a href="https://github.com/rustwasm/twiggy">twiggy</a> to profile the code size of Wasm binaries.
It printed the following output:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">twiggy top -n 20 pkg/tinysearch_bg.wasm
 Shallow Bytes │ Shallow % │ Item
─────────────┼───────────┼────────────────────────────────
         79256 ┊    44.37% ┊ data[0]
         13886 ┊     7.77% ┊ &quot;function names&quot; subsection
          7289 ┊     4.08% ┊ data[1]
          6888 ┊     3.86% ┊ core::fmt::float::float_to_decimal_common_shortest::hdd201d50dffd0509
          6080 ┊     3.40% ┊ core::fmt::float::float_to_decimal_common_exact::hcb5f56a54ebe7361
          5972 ┊     3.34% ┊ std::sync::once::Once::call_once::{{closure}}::ha520deb2caa7e231
          5869 ┊     3.29% ┊ search
</span></code></pre>
<p>From what I can tell, the biggest chunk of our binary is occupied by the raw data section for our articles.
Next up, we got the function headers and some float to decimal helper functions, that most likely come from deserialization.</p>
<p>Finally, I tried <a href="https://github.com/rustwasm/wasm-snip">wasm-snip</a>, which replaces a WebAssembly function's body with an <code>unreachable</code> like so, but it didn't reduce code size:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">wasm-snip --snip-rust-fmt-code --snip-rust-panicking-code -o pkg/tinysearch_bg_snip.wasm pkg/tinysearch_bg_opt.wasm
</span></code></pre>
<p>After tweaking with the parameters of the cuckoo filters a bit and removing
<a href="https://en.wikipedia.org/wiki/Stop_words">stop words</a> from the articles, I
arrived at <strong>121kB</strong> (51kB gzipped) — not bad considering the average image size on the web is <a href="https://httparchive.org/reports/state-of-images#bytesImg">around 900kB</a>.
On top of that, the search functionality only gets loaded when a user clicks into the search field.</p>
<h2 id="frontend-and-glue-code">Frontend and Glue Code</h2>
<p>wasm-pack will auto-generate the JavaScript code to talk to Wasm.</p>
<p>For the search UI, I customized a few JavaScript and CSS bits from
<a href="https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_autocomplete">w3schools</a>.
It even has keyboard support!
Now when a user enters a search query, we go through the cuckoo filter of each
article and try to match the words. The results are scored by the number of
hits. Thanks to my dear colleague <a href="https://github.com/jorgelbg/">Jorge Luis Betancourt</a> for adding that part.</p>
<p><img src="./anim-opt.gif" alt="Video of the search functionality" /></p>
<p>(Fun fact: this animation is about the same size as the uncompressed Wasm search itself.)</p>
<p>Only whole words are matched. I would love to add prefix-search, but the
binary became too big when I tried.</p>
<h2 id="usage">Usage</h2>
<p>The standalone binary to create the Wasm file is called <code>tinysearch</code>.
It expects a single path to a JSON file as an input:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">tinysearch path/to/corpus.json
</span></code></pre>
<p>This <code>corpus.json</code> contains the text you would like to index. The format is pretty straightforward:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">[
  {
    </span><span style="color:#86b300;">&quot;title&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;Article 1&quot;</span><span style="color:#61676ccc;">,
    </span><span style="color:#86b300;">&quot;url&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;https://example.com/article1&quot;</span><span style="color:#61676ccc;">,
    </span><span style="color:#86b300;">&quot;body&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;This is the body of article 1.&quot;
  </span><span style="color:#61676c;">}</span><span style="color:#61676ccc;">,
  </span><span style="color:#61676c;">{
    </span><span style="color:#86b300;">&quot;title&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;Article 2&quot;</span><span style="color:#61676ccc;">,
    </span><span style="color:#86b300;">&quot;url&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;https://example.com/article2&quot;</span><span style="color:#61676ccc;">,
    </span><span style="color:#86b300;">&quot;body&quot;</span><span style="color:#61676ccc;">: </span><span style="color:#86b300;">&quot;This is the body of article 2.&quot;
  </span><span style="color:#61676c;">}
]
</span></code></pre>
<p>You can generate this JSON file with any static site generator.
<a href="https://github.com/mre/mre.github.io/tree/1c731717b48afb584e54ca4dd5fd649f9b74e51c/templates">Here's my version for Zola</a>:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">{</span><span style="color:#ed9366;">% </span><span style="color:#f29718;">set </span><span style="color:#ff8f40;">section </span><span style="color:#ed9366;">= </span><span style="color:#f29718;">get_section</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">path</span><span style="color:#ed9366;">=</span><span style="color:#86b300;">&quot;_index.md&quot;</span><span style="color:#61676c;">) </span><span style="color:#ed9366;">%</span><span style="color:#61676c;">}

[
  {</span><span style="font-style:italic;color:#55b4d4;">%- </span><span style="color:#fa6e32;">for </span><span style="color:#f29718;">post in </span><span style="color:#ff8f40;">section</span><span style="color:#ed9366;">.</span><span style="color:#ff8f40;">pages </span><span style="color:#ed9366;">-%</span><span style="color:#61676c;">}
    {</span><span style="color:#ed9366;">% </span><span style="color:#fa6e32;">if </span><span style="color:#ed9366;">not </span><span style="color:#ff8f40;">post</span><span style="color:#ed9366;">.</span><span style="color:#f29718;">draft </span><span style="color:#ed9366;">%</span><span style="color:#61676c;">}
      {
        </span><span style="color:#86b300;">&quot;title&quot;</span><span style="color:#ed9366;">: </span><span style="color:#61676c;">{{ </span><span style="color:#ff8f40;">post</span><span style="color:#ed9366;">.</span><span style="color:#ff8f40;">title </span><span style="color:#ed9366;">| </span><span style="color:#ff8f40;">striptags </span><span style="color:#ed9366;">| </span><span style="color:#ff8f40;">json_encode </span><span style="color:#ed9366;">| </span><span style="color:#ff8f40;">safe </span><span style="color:#61676c;">}}</span><span style="color:#61676ccc;">,
        </span><span style="color:#86b300;">&quot;url&quot;</span><span style="color:#ed9366;">: </span><span style="color:#61676c;">{{ </span><span style="color:#ff8f40;">post</span><span style="color:#ed9366;">.</span><span style="color:#ff8f40;">permalink </span><span style="color:#ed9366;">| </span><span style="color:#ff8f40;">json_encode </span><span style="color:#ed9366;">| </span><span style="color:#ff8f40;">safe </span><span style="color:#61676c;">}}</span><span style="color:#61676ccc;">,
        </span><span style="color:#86b300;">&quot;body&quot;</span><span style="color:#ed9366;">: </span><span style="color:#61676c;">{{ </span><span style="color:#ff8f40;">post</span><span style="color:#ed9366;">.</span><span style="color:#ff8f40;">content </span><span style="color:#ed9366;">| </span><span style="color:#ff8f40;">striptags </span><span style="color:#ed9366;">| </span><span style="color:#ff8f40;">json_encode </span><span style="color:#ed9366;">| </span><span style="color:#ff8f40;">safe </span><span style="color:#61676c;">}}
      }
      {</span><span style="color:#ed9366;">% </span><span style="color:#fa6e32;">if </span><span style="color:#ed9366;">not </span><span style="color:#ff8f40;">loop</span><span style="color:#ed9366;">.</span><span style="color:#fa6e32;">last </span><span style="color:#ed9366;">%</span><span style="color:#61676c;">}</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">{</span><span style="color:#ed9366;">% </span><span style="color:#f29718;">endif </span><span style="color:#ed9366;">%</span><span style="color:#61676c;">}
    {</span><span style="color:#ed9366;">% </span><span style="color:#f29718;">endif </span><span style="color:#ed9366;">%</span><span style="color:#61676c;">}
  {</span><span style="font-style:italic;color:#55b4d4;">%- </span><span style="color:#ff8f40;">endfor </span><span style="color:#ed9366;">-%</span><span style="color:#61676c;">}
]
</span></code></pre>
<p>I'm pretty sure that the Jekyll version looks quite similar.
<a href="https://learn.cloudcannon.com/jekyll/output-json/">Here's a starting point</a>.
If you get something working for your static site generator, please let me know.</p>
<h2 id="observations">Observations</h2>
<ul>
<li>This is still the wild west: unstable features, nightly Rust, documentation
gets outdated almost every day.<br />
Bring your thinking cap!</li>
<li>Creating a product out of a good idea is a lot of work. One has to pay
attention to many factors: ease-of-use, generality, maintainability,
documentation, and so on.</li>
<li>Rust is very good at removing dead code, so you usually don't pay for what
you don't use. I would still advise you to be very conservative about the
dependencies you add to a Wasm binary because it's tempting to add features
that you don't need and which will add to the binary size. For example, I
used <a href="https://github.com/TeXitoi/structopt">StructOpt</a> during testing, and I had a <code>main()</code> function that was parsing
these command-line arguments. This was not necessary for Wasm, so I
removed it later.</li>
<li>I understand that not everyone wants to write Rust code. It's <a href="https://endler.dev/2017/go-vs-rust/">complicated to
get started with</a>, but the cool thing is that you can
use almost any other language, too. For example, you can write Go code and
transpile to Wasm, or maybe you prefer PHP or Haskell. There is support for
<a href="https://github.com/appcypher/awesome-wasm-langs">many languages</a> already.</li>
<li>A lot of people dismiss WebAssembly as a toy technology. They couldn't be
further from the truth. In my opinion, WebAssembly will revolutionize the way we build
products for the web and beyond. What was very hard just two years ago is now
easy: shipping code in any language to every browser. I'm super excited about
its future.</li>
<li>If you're looking for a standalone, self-hosted search index for your company
website, check out <a href="https://journal.valeriansaliou.name/announcing-sonic-a-super-light-alternative-to-elasticsearch/">sonic</a>.</li>
</ul>
<h2 id="try-it">Try it!</h2>
<p>The code for <a href="https://github.com/mre/tinysearch">tinysearch is on Github</a>.</p>
<p>Please be aware of these limitations:</p>
<ul>
<li><strong>Only searches for entire words.</strong> There are no search suggestions.
The reason is that prefix search blows up binary size like <a href="https://www.youtube.com/watch?v=b6u9WJ01Oxs">Mentos and Diet Coke</a>.</li>
<li>Since we bundle all search indices for all articles into one static binary, I
<strong>only recommend to use it for low- to medium-size websites</strong>. Expect around 4kB
(non-compressed) per article.</li>
<li><strike>The <strong>compile times are abysmal</strong> at the moment (around 1.5 minutes after a
fresh install on my machine), mainly because we're compiling the Rust crate
from scratch every time we rebuild the index.</strike><br />
Update: This is mostly fixed thanks to the awesome work of
<a href="https://github.com/CephalonRho">CephalonRho</a> in PR
<a href="https://github.com/mre/tinysearch/pull/13">#13</a>. Thanks again!</li>
</ul>
<p>The final Wasm code is laser-fast because we save the roundtrips to a
search-server. The instant feedback loop feels more like filtering a list than
searching through files. It can even work fully offline, which might be nice if
you like to bundle it with an app.</p>


  <ul class='post-links'>
    
    <li>
      
💬 Comments on

<a href="https:&#x2F;&#x2F;news.ycombinator.com&#x2F;item?id=23473303">Hacker News</a>,

<a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;rust&#x2F;comments&#x2F;dl1sw2&#x2F;a_tiny_static_fulltext_search_engine_using_rust&#x2F;">Reddit - Rust</a>,

<a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;programming&#x2F;comments&#x2F;h037xb&#x2F;a_tiny_static_fulltext_search_engine_using_rust&#x2F;">Reddit - Programming</a>.


    </li>
    
    
  </ul>
  <div class="info">
  <p>
    Thanks for reading! If you would like to receive future posts automatically,
    you can subscribe via email or <a href="/rss.xml">RSS</a>.
  </p>
  <form
    action="https://tinyletter.com/mre"
    method="post"
    target="popupwindow"
    onsubmit="window.open('https://tinyletter.com/mre', 'popupwindow', 'scrollbars=yes,width=800,height=600'); return true"
  >
    <p>
      <input
        class="field"
        type="email"
        name="email"
        id="tlemail"
        placeholder="E-Mail address"
        aria-label="E-mail address"
      />
      <input type="hidden" value="1" name="embed" /><input
        class="field submit"
        type="submit"
        value="Subscribe"
      />
    </p>
  </form>
  <p>
    Want to read more stories?
    <a
      class="btn btn-sm"
      aria-label="Sponsor Matthias on Github"
      href="https://github.com/sponsors/mre/"
    >
      <svg
        class="btn-ico"
        viewBox="0 0 16 16"
        version="1.1"
        width="16"
        height="16"
        aria-hidden="true"
      >
        <path
          fill-rule="evenodd"
          d="M4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.565 20.565 0 008 13.393a20.561 20.561 0 003.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.75.75 0 01-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5zM8 14.25l-.345.666-.002-.001-.006-.003-.018-.01a7.643 7.643 0 01-.31-.17 22.075 22.075 0 01-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.08 22.08 0 01-3.744 2.584l-.018.01-.006.003h-.002L8 14.25zm0 0l.345.666a.752.752 0 01-.69 0L8 14.25z"
        ></path></svg
      ><span>Sponsor</span></a
    >
  </p>
</div>

  
  
Thanks to  

<a href="https:&#x2F;&#x2F;github.com&#x2F;ebarriosjr">Esteban Barrios</a>,

<a href="https:&#x2F;&#x2F;github.com&#x2F;jorgelbg&#x2F;">Jorge Luis Betancourt</a>,

<a href="https:&#x2F;&#x2F;github.com&#x2F;pizzamig">Luca Pizzamiglio</a>,

<a href="https:&#x2F;&#x2F;github.com&#x2F;schalkneethling">Schalk Neethling</a>,

<a href="https:&#x2F;&#x2F;github.com&#x2F;m3t0r">Simon Brüggen</a>,

<a href="https:&#x2F;&#x2F;github.com&#x2F;mh84">mh84</a>

for reviewing drafts of this article.

  

</article>

        </div>
      </main>
    </div>
    

<section id="teaser">
  <div class="body">
    <h2><a href="https:&#x2F;&#x2F;endler.dev&#x2F;2019&#x2F;maybe-you-dont-need-kubernetes&#x2F;">Maybe You Don&#x27;t Need Kubernetes</a></h2>
    <p>
      
        Kubernetes is the 800-pound gorilla of container orchestration.  It powers some of the biggest deployments worldwide, but it comes with a price tag...
      
      <a href="https:&#x2F;&#x2F;endler.dev&#x2F;2019&#x2F;maybe-you-dont-need-kubernetes&#x2F;">Continue reading</a>
    </p>
  </div>
</section>


 <footer>
    <div class="body">
        <div>
            <h2><a href="/about">About me</a></h2>
            <p>
                I'm a Backend Engineer running <i><a href="https://hello-rust.show/">Hello, Rust!</a></i>, a YouTube
                channel about the Rust
                programming language and <a href="https://analysis-tools.dev/">analysis-tools.dev</a>, an open platform for static analysis tools.
                On this blog, you'll mostly find articles about programming in
                <a href="/2017/yes/">Rust</a> and <a href="/2018/go-io-testing/">Golang</a> or developer tools like <a
                    href="/2017/makefiles/">make</a> and <a href="/2018/ten-years-of-vim/">Vim</a>. 
                    Don't know where to start? Check out the <a href="/archive">blog archive</a>.
            </p>
        </div>
        <div>
            <h2><a href="https://github.com/sponsors/mre/">Support</a></h2>
            <p>
                Maintaining this blog and my projects is a lot of work. With
                your help I can spend more time writing and developing. The
                best way to support me is to <a
                href="https://github.com/sponsors/mre/">sponsor me on
                GitHub</a>.  GitHub will even match sponsorships until October
                2020!  Alternatively, I also have a <a
                href="https://www.patreon.com/hellorust">Patreon</a> account.
                Thank you! ❤️
            </p>
        </div>
    </div>
</footer>
  </body>
</html>
