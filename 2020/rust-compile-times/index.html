

<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      html,body,div,form,fieldset,legend,label,h1,h2{margin:0;padding:0}body{font-family:"Book Antiqua","Palatino Linotype",Palatino,"EB Garamond",serif;font-size:1.2em;line-height:1.58;color:#111;border-top:0.5em solid #c35}.container{display:grid;grid-template-columns:auto;margin:0 auto}header{font-size:0.8em;text-align:center;padding-top:30px}.bio{width:210px;margin:auto;padding:16px}main{padding:5px;margin-bottom:50px;max-width:650px}main article{margin-bottom:44px}main img,main video,iframe{max-width:100%;height:auto}.homepage h1{font-size:130%}h1,h2,h3,h4,h5,h6,th,td,caption{font-weight:400}h1{font-size:1.87em;margin-bottom:8px}h2{font-size:1.2em}main h2{margin-top:60px}h3{margin-top:0px;font-style:italic}header nav ul{display:inline-block;padding-left:0px;margin-top:0}header nav li{list-style:none;display:inline}.post-meta{font-style:italic;margin:0px;font-size:90%}.homepage .post-meta{font-size:80%}.btn{color:#111;background-color:#fafafa;display:inline-block;font-weight:500;border-radius:6px;border:1px solid rgba(27,31,35,0.15);text-decoration:none;box-shadow:0 1px 0 rgba(27,31,35,0.04),inset 0 1px 0 rgba(255,255,255,0.25);transition:background-color 0.2s cubic-bezier(0.3, 0, 0.5, 1);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;padding:5px 16px;white-space:nowrap}.btn-sm{padding:3px 12px;font-size:15px;line-height:20px}.btn-ico{margin-right:4px;vertical-align:text-bottom;transition:transform 0.15s cubic-bezier(0.2, 0, 0.13, 2);transform:scale(1);color:#ff1c76;fill:currentColor}.btn:hover .btn-ico{transform:scale(1.1)}pre,code{font-family:operator mono,sfmono-regular,Consolas,liberation mono,Menlo,Courier,monospace}pre{display:inline-grid;border-radius:6px;width:100%;padding:5px 0}code{font-size:0.8em;padding:2px}pre>code{overflow-x:auto;display:inline-block}:not(pre)>code{color:#111;background:#fafafa;border-radius:6px;box-shadow:0 1px 1px rgba(0,0,0,0.125)}blockquote{border-left:4px solid #9fd6fa;font-style:italic;margin:4px 10px;padding:0px 20px}::selection{background:black;color:white}a{color:#111;text-decoration:underline;text-decoration-color:#c35;text-decoration-thickness:2px;transition:text-decoration-color 200ms}a:hover{text-decoration-color:#111}.icon{height:24px;width:24px;opacity:0.4;float:left;margin:5px;background-repeat:no-repeat}.icon:hover{opacity:1;transition:opacity 200ms ease-in}figure{font-size:0.9em;font-style:italic;margin:40px 0 40px;padding:0;text-align:center;text-indent:0}figcaption{margin-top:10px}.post-links{list-style:none;padding:0}.comments{list-style:none;display:inline}#teaser{background:#c35;color:#f5b2c8}#teaser a,footer a{color:white}#teaser a::after{content:"\a0»"}footer{background:#234;color:#b9b9b9}#teaser,footer{display:flex;justify-content:center}#teaser .body,footer .body{max-width:800px;margin:40px auto;padding:20px}.field{padding:10px;font-size:0.8em;border:none;border:1px solid #b9b9b9}.autocomplete{position:relative;display:inline-block}.autocomplete input{border:1px solid #ddd;padding:10px 20px;border-radius:20px;width:150px;font-size:0.9em;box-shadow:0 1px 0px rgba(255,255,255,0.25)}input[type="submit"]{cursor:pointer;background-color:#b9b9b9}input:focus::placeholder{color:transparent}.autocomplete-items{position:absolute;left:0;top:38px;font-size:0.9em;line-height:1.5;width:100%}.autocomplete-items div{padding:10px;cursor:pointer;background-color:white;border:1px solid #ddd}.autocomplete-items div:hover,.autocomplete-active{background-color:#c35 !important;color:white}@media screen and (min-width: 600px){.container{justify-content:center;margin-top:40px;grid-template-columns:auto auto}header{position:sticky;top:0;height:100vh;box-sizing:border-box}main{padding:0px 30px;margin-top:20px}pre{padding:10px}.bio span:after{content:"Writes about Rust, engineering culture, and socks."}}@media not screen and (max-width: 800px){.searchicon{display:none}}@media screen and (max-width: 800px){#searchbox{display:none}#searchbox:target{display:block}.autocomplete{width:100%;font-size:1.1em}.autocomplete input{width:calc(100% - 100px);margin:20px 10px}.autocomplete-items{top:58px}}.info{padding:20px;margin:30px 0;background-color:lightyellow;border:4px solid peachpuff;position:relative;border-radius:6px}.logo_font{position:relative;width:165px;height:34px;margin:0 auto}.logo_font svg{position:absolute;top:0;left:0}@media (prefers-color-scheme: light){.logo_font_dark{display:none}}@media (prefers-color-scheme: dark){.logo_font_light{display:none}}@media (prefers-color-scheme: dark){body{background:#234;color:white;border-top:0.5em solid #ff1c76}.bio,.post-meta{color:#b9b9b9}a{color:white;text-decoration-color:#ff1c76}a:hover{text-decoration-color:white}.icon{filter:brightness(0) invert(1)}main img{background-color:white;border-radius:6px}table{width:100%}table a{border:none}th,td{border-bottom:1px solid #ddd}pre,code{-webkit-filter:invert(100%);filter:invert(100%)}.info{background:#141f2b;border-color:#555}.btn{background:#111;color:white}.autocomplete input,.autocomplete-items div{border:0;background:#141f2b;color:white}footer{background:#141f2b}}

    </style>
<title>Tips for Faster Rust Compile Times | Matthias Endler</title>
<link rel="canonical" href="https://endler.dev/2020/rust-compile-times/">

<meta property="og:title" content="Tips for Faster Rust Compile Times | Matthias Endler" />
<meta property="og:type" content="website" />
<meta property="og:description" content="When it comes to runtime performance, Rust is o…" />
<meta property="og:url" content="https://endler.dev/2020/rust-compile-times/" />
<meta property="og:image" content="https://endler.dev/default.png" />

<meta name="twitter:title" content="Tips for Faster Rust Compile Times">
<meta name="twitter:description" content="When it comes to runtime performance, Rust is o…">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@matthiasendler">
<meta name="twitter:creator" content="@matthiasendler">
<meta name="twitter:image" content="https://endler.dev/default.png">
    <link rel="canonical" href="https://endler.dev/2020/rust-compile-times/" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/apple-touch-icon.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon-32x32.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon-16x16.png?v=m2llJQPQq8"
    />
    <link
      rel="mask-icon"
      href="/safari-pinned-tab.svg?v=m2llJQPQq8"
      color="#5bbad5"
    />
    <link rel="shortcut icon" href="/favicon.ico?v=m2llJQPQq8" />
    <link href="/rss.xml" rel="alternate" type="application/rss+xml" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="author" content="Matthias Endler" />
    <meta
      name="description"
      content="Personal website of Matthias Endler, a Software Engineer interested in low-level programming and Backend development. Rust, Go"
    />
  </head>

  <body>
    <div class="container">
      <header>
        



<a href="/" aria-label="Go back to homepage">
  
  
  <div class="logo" style="width: 110px; margin: auto;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 456 456"><defs/><g letter-spacing="0" transform="translate(-167)" word-spacing="0"><circle cx="395" cy="228" r="220" fill="#fff" stroke="#000" stroke-width="16"/><path fill="#856800" fill-rule="evenodd" d="M468 266l-70 37-77-37z"/><path fill="#ffcb15" fill-rule="evenodd" d="M468 266l-70 31-77-31z"/><path d="M360 208a22 21 85 00-2 0 22 21 85 00-19 24 22 21 85 0023 19 22 21 85 0019-23 22 21 85 00-7-14 5 6 0 012 4 5 6 0 01-6 7 5 6 0 01-5-7 5 6 0 016-6 5 6 0 013 1 22 21 85 00-14-5zm71 1a22 21 85 00-2 0 22 21 85 00-19 23 22 21 85 0022 20 22 21 85 0019-24 22 21 85 00-20-19zm10 4a5 6 0 015 6 5 6 0 01-5 6 5 6 0 01-5-6 5 6 0 015-6z"/></g><path fill-rule="evenodd" d="M262 58c-4 9-12 19-19 24 1-8 2-16 1-22-4 8-12 18-20 24 2-7 2-15 1-21-7 13-15 24-29 28-70 20-131 113-152 213 11 28 29 53 51 73 8-158 45-267 112-208 10 9 16 13 20 13 5 0 10-4 21-13 67-59 105 50 112 208 22-20 40-45 51-73-20-95-77-184-144-209l-10-4c4-8 7-23 5-33z"/></svg>
  </div>
  <div class="logo_font">
    <div class="logo_font_dark">
    <?xml version="1.0" encoding="UTF-8"?>
<svg class="logo_font_dark" version="1.1" viewBox="0 0 786 139" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="m69.2 12.8v112h48.6v-12.2h-36v-31.8h29.8v-12.2h-29.8v-43.2h36v-12.2z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m213 12.8h-12.6v112h12.6c31 0 56.3-24.6 56.3-55.7 0-31.2-25.3-55.8-56.3-55.8zm0 12.2c24.2 0 43.7 19.5 43.7 43.7 0 24-19.5 43.5-43.7 43.5z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m279 12.8v112h48.6v-12.2h-36v-99.4z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m398 12.8v112h12.6v-28c4.96 0 10.1 0.16 15-0.64l19.2 28.6h14.9l-22.7-32.3c13.8-6.56 22.7-20.2 22.7-37.4 0-24.3-18.1-41.8-42.2-41.8zm12.6 71.4v-59.2h6.88c13.9 0 29.6 9.28 29.6 29.6 0 20.3-15.4 29.6-29.6 29.6z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m338 12.8v112h48.6v-12.2h-36v-31.8h29.8v-12.2h-29.8v-43.2h36v-12.2z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m191 13.4h-11.7v73.3l-48.5-73v113h11.8v-71.6l48.4 71.7z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g><g fill="#9f9f9f"><path d="m481 106c-4.79 0-8.7 3.9-8.7 8.7 0 4.79 3.9 8.7 8.7 8.7s8.7-3.9 8.7-8.7-3.9-8.7-8.7-8.7z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m502 12.7v110h14c30.9 0 55.7-24.3 55.7-55.2 0-30.7-24.8-55-55.7-55zm14 96.7v-83.2c23.1 0 41.7 18.6 41.7 41.5 0 23.1-18.6 41.7-41.7 41.7z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m643 12.7 37.1 111 37.1-111h-14.2l-22.9 69.4-23.1-69.4z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m583 13.1v111h48.4v-12.1h-35.8v-31.7h29.6v-12.1h-29.6v-43h35.8v-12.1z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g></svg>

    </div>
    <div class="logo_font_light">
    <?xml version="1.0" encoding="UTF-8"?>
<svg class="logo_font_light" version="1.1" viewBox="0 0 786.1 139.2" xmlns="http://www.w3.org/2000/svg"><g><path d="m69.212 12.818v111.53h48.644v-12.161h-36.003v-31.843h29.762v-12.161h-29.762v-43.203h36.003v-12.161z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m212.8 12.818h-12.641v111.53h12.641c31.042 0 56.324-24.642 56.324-55.684 0-31.203-25.282-55.845-56.324-55.845zm0 12.161c24.162 0 43.684 19.522 43.684 43.683 0 24.002-19.522 43.523-43.684 43.523z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m278.6 12.818v111.53h48.644v-12.161h-36.003v-99.368z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m397.99 12.818v111.53h12.641v-28.002c4.9603 0 10.081 0.15998 15.041-0.64l19.201 28.642h14.881l-22.722-32.323c13.761-6.5605 22.722-20.162 22.722-37.443 0-24.322-18.081-41.763-42.243-41.763zm12.641 71.366v-59.205h6.8805c13.921 0 29.602 9.2807 29.602 29.602 0 20.322-15.361 29.602-29.602 29.602z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m338.3 12.818v111.53h48.644v-12.161h-36.003v-31.843h29.762v-12.161h-29.762v-43.203h36.003v-12.161z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m190.51 13.387h-11.663v73.276l-48.474-72.993v112.67h11.784v-71.581l48.352 71.722z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g><g fill="#9f9f9f"><path d="m480.93 105.53c-4.7912 0-8.6953 3.904-8.6953 8.6953 0 4.7912 3.904 8.6953 8.6953 8.6953 4.7913 0 8.6953-3.904 8.6953-8.6953 0-4.7913-3.904-8.6953-8.6953-8.6953z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m502.04 12.723v110.2h14.019c30.877 0 55.721-24.311 55.721-55.189 0-30.7-24.844-55.011-55.721-55.011zm14.019 96.713v-83.226c23.069 0 41.702 18.633 41.702 41.524 0 23.069-18.633 41.702-41.702 41.702z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m642.71 12.723 37.088 110.73 37.088-110.73h-14.196l-22.892 69.385-23.069-69.385z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m582.92 13.066v110.99h48.407v-12.102h-35.828v-31.688h29.618v-12.102h-29.618v-42.993h35.828v-12.102z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g></svg>

    </div>
  </div>
</a>

        <p class="bio">
          <span>
            Open-source maintainer, speaker, rebel.
          </span>
          <a href="/about">About me.</a>
        </p>
        





<nav>
    <ul>
        <li>
            <a class="icon" href="/" title="Go to homepage" aria-label="Go to homepage">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 61 58'><path stroke='#fff' stroke-linecap='square' stroke-width='.52916' d='M7 21v36h16V38h15v19h15V21z'/><path d='M61 26H0l15-13L30 0l15 13z'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://github.com/mre" title="Github" aria-label="Github">
                <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 578.3 578.3'><path d='M533 160c1-26-5-53-10-79-1-9-5-18-8-27-2-6-10-10-16-9l-12 3c-39 13-76 32-111 54-5 3-11 4-17 3l-41-5c-33-1-67 0-100 6-5 1-11 0-15-3-38-24-77-46-122-57-7-2-14-1-15 1l-3 6c-5 16-10 33-13 51-4 20-7 42-5 62 1 13-3 21-10 30-24 31-34 66-35 104-1 33 4 65 14 97 15 48 45 84 90 108 36 19 76 27 117 28h111c37 1 73-3 109-14 35-12 66-30 90-60 34-42 45-92 47-145 2-40-6-78-30-111a65 65 0 01-15-43zm-71 310c-16 13-35 20-55 25-39 9-79 11-119 10-39 1-78-1-116-10-28-7-54-18-72-42-29-39-36-112 11-152 12-11 26-17 41-18l53-3 133 3c20 0 40-5 60-4 18 2 38 5 54 12 28 12 42 37 47 66 7 43-2 83-37 113z'/><ellipse cx='390' cy='385.6' rx='42.1' ry='56.3'/><ellipse cx='189' cy='385.6' rx='42.1' ry='56.3'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://twitter.com/matthiasendler" title="Twitter"
                aria-label="Twitter">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 612 612'><path fill='#010002' d='M612 116c-23 10-47 17-72 20 26-15 46-40 55-69-24 14-51 24-80 30a125 125 0 0 0-217 86c0 10 1 19 3 29-104-6-196-56-258-132a125 125 0 0 0 39 168c-21-1-40-6-57-16v2c0 61 43 111 100 123a127 127 0 0 1-56 2c16 50 62 86 117 87A252 252 0 0 1 0 498a355 355 0 0 0 550-301l-1-16c25-17 46-40 63-65z'/></svg> 
            </a>
        </li>
        <li>
            <a class="icon" href="/rss.xml" title="RSS feed"
                aria-label="RSS feed"><svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 1280 1280'><path d='M264 224l-1 79v79h8a660 660 0 0 1 438 174 665 665 0 0 1 218 492h156l1-26a820 820 0 0 0-715-792c-37-5-103-9-105-6z'/><path d='M263 504l-1 78 1 79 14 2a383 383 0 0 1 369 368l1 17h158v-19a536 536 0 0 0-98-293 546 546 0 0 0-444-232zM353 830a110 110 0 0 0-77 160 110 110 0 1 0 188-114c-5-7-23-25-30-29-25-16-54-22-81-17z'/></svg></a>
        </li>
        <li>
            <a class="searchicon icon" href="#searchbox" title="Search"
                aria-label="Search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90.1 90.1"><defs/><path d="M71.8 62.6a39.6 39.6 0 10-9.2 9.2L79 88.2a6.5 6.5 0 009.2-9.2zM13 39.6a26.5 26.5 0 1126.5 26.5 26.5 26.5 0 01-26.5-26.5z"/></svg>
            </a>
        </li>
    </ul>
</nav> 
<script type="module">async function lazyLoad(){await init("/tinysearch_engine_bg.wasm")}var loaded=!1;function autocomplete(e){var t;function n(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),t>=e.length&&(t=0),t<0&&(t=e.length-1),e[t].classList.add("autocomplete-active")}function a(t){for(var n=document.getElementsByClassName("autocomplete-items"),a=0;a<n.length;a++)t!=n[a]&&t!=e&&n[a].parentNode.removeChild(n[a])}e.addEventListener("click",(function(e){loaded||(lazyLoad(),loaded=!0)})),e.addEventListener("input",(function(e){var n,o,i,c=this.value;if(a(),!c)return!1;t=-1,(n=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),n.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(n);let r=search(c,3);for(i=0;i<r.length;i++){let e=r[i];(o=document.createElement("DIV")).innerHTML=e[0],o.addEventListener("click",(function(t){window.location.href=`${e[1]}?q=${encodeURIComponent(c)}`})),n.appendChild(o)}})),e.addEventListener("keydown",(function(e){var a=document.getElementById(this.id+"autocomplete-list");a&&(a=a.getElementsByTagName("div")),40==e.keyCode?(t++,n(a)):38==e.keyCode?(t--,n(a)):13==e.keyCode&&(e.preventDefault(),t>-1&&a&&a[t].click())})),document.addEventListener("click",(function(e){a(e.target)}))}let wasm;autocomplete(document.getElementById("tinysearch"));let WASM_VECTOR_LEN=0,cachedTextEncoder=new TextEncoder("utf-8");const encodeString="function"==typeof cachedTextEncoder.encodeInto?function(e,t){return cachedTextEncoder.encodeInto(e,t)}:function(e,t){const n=cachedTextEncoder.encode(e);return t.set(n),{read:e.length,written:n.length}};let cachegetUint8Memory=null;function getUint8Memory(){return null!==cachegetUint8Memory&&cachegetUint8Memory.buffer===wasm.memory.buffer||(cachegetUint8Memory=new Uint8Array(wasm.memory.buffer)),cachegetUint8Memory}function passStringToWasm(e){let t=e.length,n=wasm.__wbindgen_malloc(t);const a=getUint8Memory();let o=0;for(;o<t;o++){const t=e.charCodeAt(o);if(t>127)break;a[n+o]=t}if(o!==t){0!==o&&(e=e.slice(o)),n=wasm.__wbindgen_realloc(n,t,t=o+3*e.length);const a=getUint8Memory().subarray(n+o,n+t);o+=encodeString(e,a).written}return WASM_VECTOR_LEN=o,n}const heap=new Array(32);function getObject(e){return heap[e]}heap.fill(void 0),heap.push(void 0,null,!0,!1);let heap_next=heap.length;function dropObject(e){e<36||(heap[e]=heap_next,heap_next=e)}function takeObject(e){const t=getObject(e);return dropObject(e),t}export function search(e,t){return takeObject(wasm.search(passStringToWasm(e),WASM_VECTOR_LEN,t))}let cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});function getStringFromWasm(e,t){return cachedTextDecoder.decode(getUint8Memory().subarray(e,e+t))}function addHeapObject(e){heap_next===heap.length&&heap.push(heap.length+1);const t=heap_next;return heap_next=heap[t],heap[t]=e,t}function init(e){let t;void 0===e&&(e=import.meta.url.replace(/\.js$/,"_bg.wasm"));const n={wbg:{}};if(n.wbg.__wbindgen_json_parse=function(e,t){return addHeapObject(JSON.parse(getStringFromWasm(e,t)))},"function"==typeof URL&&e instanceof URL||"string"==typeof e||"function"==typeof Request&&e instanceof Request){const a=fetch(e);t="function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,n).catch(e=>a.then(t=>{if("application/wasm"!=t.headers.get("Content-Type"))return console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e),t.arrayBuffer();throw e}).then(e=>WebAssembly.instantiate(e,n))):a.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,n))}else t=WebAssembly.instantiate(e,n).then(t=>t instanceof WebAssembly.Instance?{instance:t,module:e}:t);return t.then(({instance:e,module:t})=>(wasm=e.exports,init.__wbindgen_wasm_module=t,wasm))}export default init;</script>
<form id="searchbox" autocomplete="off">
    <div class="autocomplete">
        <input id="tinysearch" type="text" aria-label="Search through articles" placeholder="&#x1F50D; Search">
    </div>
</form>
      </header>

      <main>
        
<article>
  <p class='post-meta'>Published on 





21st of June, 2020


  </p>
  <h1>Tips for Faster Rust Compile Times</h1>
  
  <p>When it comes to runtime performance, Rust is one of the fastest guns in the
west. It is <a href="https://benchmarksgame-team.pages.debian.net/benchmarksgame/which-programs-are-fastest.html">on par with the likes of C and
C++</a>
and sometimes even surpasses them. Compile times, however? That's a different story.</p>
<h2 id="why-is-rust-compilation-slow">Why Is Rust Compilation Slow?</h2>
<p>Wait a sec, slow in comparison to what? For example, if you compare it with Go,
their compiler is doing a lot less work in general. It lacks support for
generics and macros. Also, the Go compiler was <a href="https://golang.org/doc/faq#What_compiler_technology_is_used_to_build_the_compilers">built from
scratch</a>
as a monolithic tool consisting of both, the frontend and the backend (rather
than relying on, say, <a href="https://llvm.org/">LLVM</a> to take over the backend part,
which is the case for Rust or Swift). This has advantages (more options for
tweaking the entire process, yay) and disadvantages (higher maintenance costs
and less supported architectures).</p>
<p>Comparing across toolchains makes little sense here, and compile times are
mostly fine for smaller projects, so if your project builds fast enough, your
job here is done.</p>
<h2 id="choosing-runtime-over-compile-time-performance">Choosing Runtime Over Compile-Time Performance</h2>
<blockquote>
<p>As is often cautioned in debates among their designers, programming language
design is full of tradeoffs. One of those fundamental tradeoffs is runtime
performance vs. compile-time performance, and the Rust team nearly always (if
not always) chose runtime over compile-time.<br />
— <a href="https://pingcap.com/blog/rust-compilation-model-calamity/">Brian Anderson</a></p>
</blockquote>
<p>Overall, there are a few features and design decisions that limit Rust
compilation speed:</p>
<ul>
<li><strong>Macros</strong>: Code generation with macros can be quite expensive.</li>
<li><strong>Type checking</strong></li>
<li><strong>Monomorphization</strong>: this is the process of generating specialized versions
of generic functions. E.g., a function that takes an <code>Into&lt;String&gt;</code> gets
converted into one that takes a <code>String</code> and one that takes a <code>&amp;str</code>.</li>
<li><strong>LLVM</strong>: that's the default compiler backend for Rust, where a lot of the
heavy-lifting (like code-optimizations) takes place. LLVM is <a href="https://nikic.github.io/2020/05/10/Make-LLVM-fast-again.html">notorious for
being slow</a>.</li>
<li><strong>Linking</strong>: Strictly speaking, this is not part of compiling but happens
right after. It &quot;connects&quot; your Rust binary with the system libraries. <code>cargo</code>
does not explicitly mark the linking step, so many people add it to the
overall compilation time.</li>
</ul>
<p>If you're interested in all the gory details, check out <a href="https://pingcap.com/blog/rust-compilation-model-calamity/">this blog
post</a> by Brian
Anderson.</p>
<h2 id="upstream-work">Upstream Work</h2>
<p>Making the Rust compiler faster is an ongoing process, and many fearless people
are <a href="https://blog.mozilla.org/nnethercote/2020/04/24/how-to-speed-up-the-rust-compiler-in-2020/">working on
it</a>.
Thanks to their hard work, compiler speed has improved <a href="https://www.reddit.com/r/rust/comments/cezxjn/compiler_speed_has_improved_3040_across_the_board/">30-40% across the board
year-to-date, with some projects seeing up to 45%+ improvements</a>.
On top of that, Rust tracks compile regressions on a <a href="https://perf.rust-lang.org/">website dedicated to
performance</a></p>
<p>Work is also put into <a href="https://nikic.github.io/2020/05/10/Make-LLVM-fast-again.html">optimizing the LLVM
backend</a>. Rumor
has it that there's still a lot of low-hanging fruit. 🍇</p>
<h2 id="why-bother">Why Bother?</h2>
<p>Overall, the Rust compiler is legitimately doing a great job. That said, above a
certain project size, the compile times are... let's just say they could be
better.</p>
<p>According to the <a href="https://blog.rust-lang.org/2020/04/17/Rust-survey-2019.html">Rust 2019
survey</a>, improving
compile times is #4 on the Rust wishlist:</p>
<figure>
        <img src="rust-survey.svg" 
        loading="lazy"
            alt="Rust Survey results 2019. (<a href='https://xkcd.com/303/'>Obligatory xkcd</a>.)"
        />
    <figcaption>
        Rust Survey results 2019. (<a href='https://xkcd.com/303/'>Obligatory xkcd</a>.)
    </figcaption>
</figure>
<p>But all hope is not lost! Below is a list of <strong>tips and tricks on how to make
your Rust project compile faster today</strong>. They are roughly ordered by
practicality, so start at the top and work your way down until you're happy.</p>
<h2 id="use-cargo-check-instead-of-cargo-build">Use <code>cargo check</code> Instead Of <code>cargo build</code></h2>
<p>Most of the time, you don't even have to compile your project at all; you just
want to know if you messed up somewhere. Whenever you can, skip compilation
altogether. What you want instead is laser-fast code linting, type- and
borrow-checking.</p>
<p>For that, cargo has a special treat for you: ✨ <code>cargo check</code> ✨. Consider the
differences in the number of instructions between <code>cargo check</code> on the left and
<code>cargo debug</code> in the middle. (Note that the scales are different.)</p>
<p><img src="https://endler.dev/2020/rust-compile-times/cargo-check.webp" alt="Speedup factors: check 1, debug 5, opt 20" /></p>
<p>A sweet trick I use is to run it in the background with <a href="https://github.com/passcod/cargo-watch"><code>cargo watch</code></a>. This way, it will <code>cargo check</code>
whenever you change a file.</p>
<p>⭐ <strong>Pro-tip</strong>: Use <code>cargo watch -c</code> to clear the screen before every run.</p>
<h2 id="use-rust-analyzer-instead-of-rust-language-server">Use Rust Analyzer Instead Of Rust Language Server</h2>
<p>Another quick way to check if you set the codebase on fire is to use a &quot;language
server&quot;. That's basically a &quot;linter as a service&quot;, that runs next to your
editor.</p>
<p>For a long time, the default choice here was
<a href="https://github.com/rust-lang/rls">rls</a>, but lately, folks moved over to
<a href="https://github.com/rust-analyzer/rust-analyzer">rust-analyzer</a>, because it's
more feature-complete and way more snappy. It supports all major IDEs.
Switching to that alone might save your day.</p>
<h2 id="remove-unused-dependencies">Remove Unused Dependencies</h2>
<p>So let's say you tried all of the above and find that compilation is still slow.
What now?</p>
<p>Dependencies sometimes become obsolete thanks to refactoring. From time to time
it helps to check if all of them are still needed to save compile time.</p>
<p>If this is your own project (or a project you like to contribute to), do a quick
check if you can toss anything with
<a href="https://github.com/est31/cargo-udeps">cargo-udeps</a>:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#f29718;">cargo</span><span style="color:#61676c;"> install cargo-udeps </span><span style="color:#ed9366;">&amp;&amp; </span><span style="color:#f29718;">cargo</span><span style="color:#61676c;"> +nightly udeps
</span></code></pre><h2 id="update-remaining-dependencies">Update Remaining Dependencies</h2>
<p>Next, update your dependencies, because they themselves could have tidied up
their dependency tree lately.</p>
<p>Take a deep dive with
<a href="https://github.com/kbknapp/cargo-outdated"><code>cargo-outdated</code></a> or <code>cargo tree</code>
(built right into cargo itself) to find any outdated dependencies. On top of
that, use <a href="https://github.com/RustSec/cargo-audit"><code>cargo audit</code></a> to get
notified about any vulnerabilities which need to be addressed, or deprecated
crates which need a replacement.</p>
<p>Here's a nice workflow that I learned from <a href="https://www.reddit.com/r/rust/comments/gi7v2v/is_it_wrong_of_me_to_think_that_rust_crates_have/fqe848y">/u/oherrala on
Reddit</a>:</p>
<ol>
<li>Run <code>cargo update</code> to update to the latest <a href="https://semver.org/">semver</a>
compatible version.</li>
<li>Run <code>cargo outdated -wR</code> to find newer, possibly incompatible dependencies.
Update those and fix code as needed.</li>
<li>Find duplicate versions of a dependency and figure out
where they come from: <code>cargo tree --duplicate</code> shows dependencies which come in multiple versions.<br />
(Thanks to /u/dbdr for <a href="https://www.reddit.com/r/rust/comments/hdb5m4/tips_for_faster_rust_compile_times/fvm1r2w/">pointing this out</a>.)</li>
</ol>
<p>⭐ <strong>Pro-tip</strong>: Step 3 is a great way to contribute back to the community! Clone
the repository and execute steps 1 and 2. Finally, send a pull request to the
maintainers.</p>
<h2 id="replace-heavy-dependencies">Replace Heavy Dependencies</h2>
<p>From time to time, it helps to shop around for more lightweight alternatives to
popular crates.</p>
<p>Again, <code>cargo tree</code> is your friend here to help you understand which of your
dependencies are quite <em>heavy</em>: they require many other crates, causing
excessive network I/O and slow down your build. Then search for lighter
alternatives.</p>
<p>Here are a few examples:</p>
<ul>
<li>Using <a href="https://github.com/serde-rs/serde">serde</a>? Check out
<a href="https://github.com/dtolnay/miniserde">miniserde</a> and maybe even
<a href="https://github.com/not-fl3/nanoserde">nanoserde</a>.</li>
<li><a href="https://github.com/seanmonstar/reqwest">reqwests</a> is quite heavy. Maybe try
<a href="https://github.com/sbstp/attohttpc">attohttpc</a> or <a href="https://github.com/algesten/ureq">ureq</a>, which are more lightweight.</li>
<li><del><a href="https://github.com/tokio-rs/tokio">tokio</a> dragging you down? How about <a href="https://github.com/stjepang/smol">smol</a>?</del><br />
(Edit: This won't help much with build times. <a href="https://www.reddit.com/r/rust/comments/hdb5m4/tips_for_faster_rust_compile_times/fvmayvh/">More info in this discussion on Reddit</a>)</li>
<li>Swap out <a href="https://github.com/clap-rs/clap">clap</a> with <a href="https://github.com/RazrFalcon/pico-args">pico-args</a> if you only need basic argument parsing.</li>
</ul>
<p><a href="https://blog.kodewerx.org/2020/06/the-rust-compiler-isnt-slow-we-are.html">Here's an
example</a>
where switching crates reduced compile times from 2:22min to 26 seconds.</p>
<h2 id="use-cargo-workspaces">Use Cargo Workspaces</h2>
<p>Cargo has that neat feature called <em>workspaces</em>, which allow you to split one
big crate into multiple smaller ones. This code-splitting is great for avoiding
repetitive compilation because only crates with changes have to be recompiled.
Bigger projects like
<a href="https://github.com/servo/servo/blob/master/Cargo.toml">servo</a> and
<a href="https://github.com/timberio/vector/blob/1629f7f82e459ae87f699e931ca2b89b9080cfde/Cargo.toml#L28-L34">vector</a>
are using workspaces heavily to slim down compile times. 
<a href="https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html">Learn more about workspaces here</a>.</p>
<h2 id="combine-all-integration-tests-in-a-single-binary">Combine All Integration Tests In A Single Binary</h2>
<p>Have any <a href="https://doc.rust-lang.org/rust-by-example/testing/integration_testing.html">integration tests</a>? (These are the ones in your <code>tests</code>
directory.)
The Rust compiler will create a binary for every single one of them.
This can take most of your build time because linking is slooow. 🐢
The reason is that many system linkers (like <code>ld</code>) are <a href="https://stackoverflow.com/questions/5142753/can-gcc-use-multiple-cores-when-linking">single
threaded</a>.</p>
<div class="info">
  👨‍🍳️💡‍️ A <a href="https://en.wikipedia.org/wiki/Linker_(computing)">linker</a> is a tool that combines the
output of a compiler and mashes that into one executable you can run.
</div>
<p>To make the linker's job a little easier, you can put all your tests in one
crate. (Basically create a <code>main.rs</code> in your test folder and add your
test files as <code>mod</code> in there.)</p>
<p>Then the linker will go ahead and build a single binary only. Sounds nice, but
careful: it's still a trade-off as you'll need to expose your internal types and
functions (i.e. make them <code>pub</code>).</p>
<p>Might be worth a try, though because a recent <a href="https://azriel.im/will/2019/10/08/dev-time-optimization-part-1-1.9x-speedup-65-less-disk-usage/">benchmark revealed a 1.9x
speedup</a> for one project.</p>
<p><em>This tip was brought to you by <a href="https://twitter.com/algo_luca">Luca Palmieri</a>,
<a href="https://twitter.com/lucio_d_franco">Lucio Franco</a>, and <a href="https://twitter.com/im_azriel">Azriel
Hoh</a>. Thanks!</em></p>
<h2 id="disable-unused-features-of-crate-dependencies">Disable Unused Features Of Crate Dependencies</h2>
<p>⚠️ <strong>Fair warning</strong>: it seems that switching off features doesn't always improve
compile time. (See <a href="https://github.com/tikv/tikv/pull/4453#issuecomment-481789292">tikv's experiences
here</a>.)</p>
<p>Check the feature flags of your dependencies. A lot of library maintainers take
the effort to split their crate into separate features that can be toggled off
on demand. Maybe you don't need all the default functionality from every crate?</p>
<p>For example, <code>tokio</code> has <a href="https://github.com/tokio-rs/tokio/blob/2bc6bc14a82dc4c8d447521005e044028ae199fe/tokio/Cargo.toml#L26-L91">a ton of
features</a>
that you can disable if needed.</p>
<p>A quick way to list the features of a crate is
<a href="https://github.com/badboy/cargo-feature-set">cargo-feature-set</a>.</p>
<p>Admittedly, <a href="https://twitter.com/llogiq/status/1273875653822222337">features are not very discoverable at the
moment</a> because there is
no standard way to document them, but we'll get there eventually.</p>
<h2 id="use-a-ramdisk-for-compilation">Use A Ramdisk For Compilation</h2>
<p>When starting to compile heavy projects, I noticed that I was throttled on I/O.
The reason was that I kept my projects on a measly HDD. A more performant
alternative would be SSDs, but if that's not an option, don't throw in the
sponge just yet.</p>
<p>Ramdisks to the rescue! These are like &quot;virtual harddisks&quot; that live in system
memory.</p>
<p>User <a href="https://www.reddit.com/user/moschroe_de/">moschroe_de</a> shared the
following snippet <a href="https://www.reddit.com/r/rust/comments/chqu4c/building_a_computer_for_fastest_possible_rust/ev02hqy">over on
Reddit</a>,
which creates a ramdisk for your current Rust project (on Linux):</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#f29718;">mkdir</span><span style="color:#ff8f40;"> -p</span><span style="color:#61676c;"> target </span><span style="color:#ed9366;">&amp;&amp; </span><span style="color:#61676ccc;">\
</span><span style="color:#f29718;">sudo</span><span style="color:#61676c;"> mount</span><span style="color:#ff8f40;"> -t</span><span style="color:#61676c;"> tmpfs none ./target </span><span style="color:#ed9366;">&amp;&amp; </span><span style="color:#61676ccc;">\
</span><span style="color:#f29718;">cat</span><span style="color:#61676c;"> /proc/mounts </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">grep </span><span style="color:#86b300;">&quot;$</span><span style="color:#61676c;">(</span><span style="color:#f29718;">pwd</span><span style="color:#61676c;">)</span><span style="color:#86b300;">&quot; </span><span style="color:#ed9366;">| </span><span style="color:#f29718;">sudo</span><span style="color:#61676c;"> tee</span><span style="color:#ff8f40;"> -a</span><span style="color:#61676c;"> /etc/fstab
</span></code></pre>
<p>On macOS, you could probably do something similar with <a href="https://gist.github.com/koshigoe/822455">this
script</a>. I haven't tried that myself,
though.</p>
<h2 id="cache-dependencies-with-sccache">Cache Dependencies With sccache</h2>
<p>Another neat project is <a href="https://github.com/mozilla/sccache">sccache</a> by
Mozilla, which caches compiled crates to avoid repeated compilation.</p>
<p>I had this running on my laptop for a while, but the benefit was rather
negligible, to be honest. It works best if you work on a lot of independent
projects that share dependencies (in the same version). A common use-case is
shared build servers.</p>
<h2 id="cranelift-the-alternative-rust-compiler">Cranelift – The Alternative Rust Compiler</h2>
<p>Lately, I was excited to hear that the Rust project is using an alternative
compiler that runs in parallel with <code>rustc</code> for every CI build:
<a href="https://github.com/bjorn3/rustc_codegen_cranelift">Cranelift</a>, also called
<code>CG_CLIF</code>.</p>
<p>Here is a comparison between <code>rustc</code> and Cranelift for some popular crates (blue
means better):</p>
<p><img src="https://endler.dev/2020/rust-compile-times/cranelift.webp" alt="LLVM compile time comparison between rustc and cranelift in favor of cranelift" /></p>
<p>Somewhat unbelieving, I tried to compile
<a href="https://github.com/timberio/vector">vector</a> with both compilers.</p>
<p>The results were astonishing:</p>
<ul>
<li>Rustc: <strong>5m 45s</strong></li>
<li>Cranelift: <strong>3m 13s</strong></li>
</ul>
<p>I could really feel the difference! What's cool about this is that it creates
fully working executable binaries. They won't be optimized as much, but they are
great for testing.</p>
<p>A more detailed write-up is on <a href="https://jason-williams.co.uk/a-possible-new-backend-for-rust">Jason Williams'
page</a>, and the
project code is <a href="https://github.com/bjorn3/rustc_codegen_cranelift">on Github</a>.</p>
<h2 id="switch-to-a-faster-linker">Switch To A Faster Linker</h2>
<blockquote>
<p>The thing that nobody seems to target is linking time. For me, when using
something with a big dependency tree like Amethyst, for example linking time
on my fairly recent Ryzen 7 1700 is ~10s each time, even if I change only some
minute detail only in my code. — <a href="https://www.reddit.com/r/rust/comments/chqu4c/building_a_computer_for_fastest_possible_rust/euycz74">/u/Almindor on
Reddit</a></p>
</blockquote>
<p>According to the <a href="https://lld.llvm.org/">official documentation</a>, &quot;LLD is a
linker from the LLVM project that is a drop-in replacement for system linkers
and runs much faster than them. [..] When you link a large program on a
multicore machine, you can expect that LLD runs more than twice as fast as the
GNU gold linker. Your mileage may vary, though.&quot;</p>
<p>If you're on Linux you can switch to <code>lld</code> <a href="https://stackoverflow.com/a/57817848/270334">like
so</a>:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">[</span><span style="color:#399ee6;">target</span><span style="color:#61676ccc;">.</span><span style="color:#399ee6;">x86_64-unknown-linux-gnu</span><span style="color:#61676c;">]
</span><span style="color:#399ee6;">rustflags </span><span style="color:#61676c;">= [
    </span><span style="color:#86b300;">&quot;-C&quot;</span><span style="color:#61676ccc;">, </span><span style="color:#86b300;">&quot;link-arg=-fuse-ld=lld&quot;</span><span style="color:#61676ccc;">,
</span><span style="color:#61676c;">]
</span></code></pre>
<p>A word of caution: <code>lld</code> might not be working on all platforms yet. At least on
macOS, Rust support seems to be broken at the moment, and the work on fixing it
has stalled (see
<a href="https://github.com/rust-lang/rust/issues/39915">rust-lang/rust#39915</a>).</p>
<h2 id="tweak-compiler-flags">Tweak Compiler Flags</h2>
<p>Rust comes with a huge set of <a href="https://doc.rust-lang.org/rustc/codegen-options/index.html">compiler
flags</a>. For special
cases, it can help to tweak them for your project.</p>
<h2 id="profile-compile-times">Profile Compile Times</h2>
<p>If you like to dig deeper, Rust compilation can be profiled with <a href="https://blog.rust-lang.org/inside-rust/2020/02/25/intro-rustc-self-profile.html#profiling-the-compiler"><code>cargo rustc -- -Zself-profile</code></a>.
The resulting trace file can be visualized with a flamegraph or the Chromium
profiler:</p>
<figure>
        <img src="chrome_profiler.webp" 
        loading="lazy"
            alt="Image of Chrome profiler with all crates"
        />
    <figcaption>
        Image of Chrome profiler with all crates
        <br />
        Rust Lang Blog
    </figcaption>
</figure>
<p>There's also a <a href="https://doc.rust-lang.org/nightly/cargo/reference/unstable.html#timings"><code>cargo -Z timings</code></a>
feature that gives some information about how long each compilation step takes,
and tracks concurrency information over time.</p>
<p>Another golden one is
<a href="https://github.com/dtolnay/cargo-llvm-lines"><code>cargo-llvm-lines</code></a>, which shows
the number of lines generated and objects copied in the LLVM backend:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">$ cargo llvm-lines | head -20

  Lines        Copies         Function name
  -----        ------         -------------
  30737 (100%)   1107 (100%)  (TOTAL)
   1395 (4.5%)     83 (7.5%)  core::ptr::drop_in_place
    760 (2.5%)      2 (0.2%)  alloc::slice::merge_sort
    734 (2.4%)      2 (0.2%)  alloc::raw_vec::RawVec&lt;T,A&gt;::reserve_internal
    666 (2.2%)      1 (0.1%)  cargo_llvm_lines::count_lines
    490 (1.6%)      1 (0.1%)  &lt;std::process::Command as cargo_llvm_lines::PipeTo&gt;::pipe_to
    476 (1.5%)      6 (0.5%)  core::result::Result&lt;T,E&gt;::map
    440 (1.4%)      1 (0.1%)  cargo_llvm_lines::read_llvm_ir
    422 (1.4%)      2 (0.2%)  alloc::slice::merge
    399 (1.3%)      4 (0.4%)  alloc::vec::Vec&lt;T&gt;::extend_desugared
    388 (1.3%)      2 (0.2%)  alloc::slice::insert_head
    366 (1.2%)      5 (0.5%)  core::option::Option&lt;T&gt;::map
    304 (1.0%)      6 (0.5%)  alloc::alloc::box_free
    296 (1.0%)      4 (0.4%)  core::result::Result&lt;T,E&gt;::map_err
    295 (1.0%)      1 (0.1%)  cargo_llvm_lines::wrap_args
    291 (0.9%)      1 (0.1%)  core::char::methods::&lt;impl char&gt;::encode_utf8
    286 (0.9%)      1 (0.1%)  cargo_llvm_lines::run_cargo_rustc
    284 (0.9%)      4 (0.4%)  core::option::Option&lt;T&gt;::ok_or_else
</span></code></pre><h2 id="avoid-procedural-macro-crates">Avoid Procedural Macro Crates</h2>
<p>Procedural macros are the hot sauce of Rust development: they burn through CPU
cycles so use with care (keyword: monomorphization).</p>
<p>If you heavily use procedural macros in your project (e.g., if you use serde),
you can try to sidestep their impact on compile times with
<a href="https://github.com/dtolnay/watt">watt</a>, a tool that offloads macro compilation
to Webassembly.</p>
<p>From the docs:</p>
<blockquote>
<p>By compiling macros ahead-of-time to Wasm, we save all downstream users of the
macro from having to compile the macro logic or its dependencies themselves.</p>
<p>Instead, what they compile is a small self-contained Wasm runtime (~3 seconds,
shared by all macros) and a tiny proc macro shim for each macro crate to hand
off Wasm bytecode into the Watt runtime (~0.3 seconds per proc-macro crate you
depend on). This is much less than the 20+ seconds it can take to compile
complex procedural macros and their dependencies.</p>
</blockquote>
<p>Note that this crate is still experimental.</p>
<p>(Oh, and did I mention that both, <code>watt</code> and <code>cargo-llvm-lines</code> were built by
<a href="https://github.com/dtolnay/">David Tolnay</a>, who is a frickin' steamroller of an
engineer?)</p>
<h2 id="compile-on-a-beefy-machine">Compile On A Beefy Machine</h2>
<p>On portable devices, compiling can drain your battery and be slow. To avoid
that, I'm using my machine at home, a 6-core AMD FX 6300 with 12GB RAM, as a
build machine. I can use it in combination with <a href="https://code.visualstudio.com/docs/remote/remote-overview">Visual Studio Code Remote
Development</a>.</p>
<p>If you don't have a dedicated machine yourself, you can compile in the cloud
instead.<br />
<a href="https://gitpod.io/">Gitpod.io</a> is superb for testing a cloud build as they
provide you with a beefy machine (currently 16 core Intel Xeon 2.30GHz, 60GB
RAM) for free during a limited period. Simply add <code>https://gitpod.io/#</code> in
front of any Github repository URL.
<a href="https://gitpod.io/#https://github.com/hello-rust/show/tree/master/episode/9">Here is an example</a> for one of my <a href="https://hello-rust.show/">Hello Rust</a> episodes.</p>
<p>When it comes to buying dedicated hardware,
<a href="https://www.reddit.com/r/rust/comments/chqu4c/building_a_computer_for_fastest_possible_rust/">here are some tips</a>. Generally, you should get a proper multicore CPU like an AMD
Ryzen Threadripper plus at least 32 GB of RAM.</p>
<h2 id="drastic-measures-overclock-your-cpu-fire">Drastic Measures: Overclock Your CPU? 🔥</h2>
<p>⚠️ Warning: You can damage your hardware if you don't know what you are doing.
Proceed at your own risk.</p>
<p>Here's an idea for the desperate. Now I don't recommend that to everyone, but
if you have a standalone desktop computer with a decent CPU, this might be a way
to squeeze out the last bits of performance.</p>
<p>Even though the Rust compiler executes a lot of steps in parallel,
single-threaded performance is still quite relevant.</p>
<p>As a somewhat drastic measure, you can try to overclock your CPU. <a href="https://www.youtube.com/watch?v=gb1QDpRnOvw">Here's a
tutorial for my processor</a>. (I owe
you some benchmarks from my machine.)</p>
<h2 id="download-all-the-crates">Download ALL The Crates</h2>
<p>If you have a slow internet connection, a big part of the initial build
process is fetching all those shiny crates from crates.io. To mitigate that,
you can download <strong>all</strong> crates in advance to cache them locally.
<a href="https://github.com/the-lean-crate/criner">criner</a> does just that:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">git clone https://github.com/the-lean-crate/criner
cd criner
cargo run --release -- mine
</span></code></pre>
<p>The archive size is surprisingly reasonable, with roughly 50GB of required disk
space.</p>
<h2 id="help-others-upload-leaner-crates-for-faster-build-times">Help Others: Upload Leaner Crates For Faster Build Times</h2>
<p><a href="https://github.com/the-lean-crate/cargo-diet"><code>cargo-diet</code></a> helps you build
lean crates that significantly reduce download size (sometimes by 98%). It might
not directly affect your own build time, but your users will surely be thankful. 😊</p>
<h2 id="what-s-next">What's Next?</h2>
<p>Phew! That was a long list. If you have any additional tips, please <a href="https://github.com/mre/mre.github.io/issues">let me know</a>.</p>
<p>If compiler performance is something you're interested in, why not <a href="https://github.com/rust-lang/measureme/issues/51">collaborate
on a tool</a> to see what user code is causing rustc to use lots of
time?</p>
<p>Also, once you're done optimizing your build times, how about optimizing
runtime next? My friend <a href="https://twitter.com/killercup/">Pascal Hertleif</a> has a
<a href="https://deterministic.space/high-performance-rust.html">nice article</a> on that.</p>


  <ul class='post-links'>
    
    <li>
      
💬 Comments on

<a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;rust&#x2F;comments&#x2F;hdb5m4&#x2F;tips_for_faster_rust_compile_times&#x2F;">Reddit</a>,

<a href="https:&#x2F;&#x2F;twitter.com&#x2F;matthiasendler&#x2F;status&#x2F;1274703741485223936">Twitter</a>.


    </li>
    
    
  </ul>
  <div class="info">
  <p>
    Thanks for reading! If you would like to receive future posts automatically,
    you can subscribe via email or <a href="/rss.xml">RSS</a>.
  </p>
  <form
    action="https://tinyletter.com/mre"
    method="post"
    target="popupwindow"
    onsubmit="window.open('https://tinyletter.com/mre', 'popupwindow', 'scrollbars=yes,width=800,height=600'); return true"
  >
    <p>
      <input
        class="field"
        type="email"
        name="email"
        id="tlemail"
        placeholder="E-Mail address"
        aria-label="E-mail address"
      />
      <input type="hidden" value="1" name="embed" /><input
        class="field submit"
        type="submit"
        value="Subscribe"
      />
    </p>
  </form>
  <p>
    Want to read more stories?
    <a
      class="btn btn-sm"
      aria-label="Sponsor Matthias on Github"
      href="https://github.com/sponsors/mre/"
    >
      <svg
        class="btn-ico"
        viewBox="0 0 16 16"
        version="1.1"
        width="16"
        height="16"
        aria-hidden="true"
      >
        <path
          fill-rule="evenodd"
          d="M4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.565 20.565 0 008 13.393a20.561 20.561 0 003.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.75.75 0 01-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5zM8 14.25l-.345.666-.002-.001-.006-.003-.018-.01a7.643 7.643 0 01-.31-.17 22.075 22.075 0 01-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.08 22.08 0 01-3.744 2.584l-.018.01-.006.003h-.002L8 14.25zm0 0l.345.666a.752.752 0 01-.69 0L8 14.25z"
        ></path></svg
      ><span>Sponsor</span></a
    >
  </p>
</div>

  
  
Thanks to  

<a href="https:&#x2F;&#x2F;twitter.com&#x2F;drwilco">DocWilco</a>,

<a href="https:&#x2F;&#x2F;github.com&#x2F;pizzamig">Luca Pizzamiglio</a>

for reviewing drafts of this article.

  

</article>

        </div>
      </main>
    </div>
    

<section id="teaser">
  <div class="body">
    <h2><a href="https:&#x2F;&#x2F;endler.dev&#x2F;2020&#x2F;gravity&#x2F;">Gravity</a></h2>
    <p>
      
        Here's a test to check your age: Do you still remember that funny JavaScript gravity effect, which Google used on their homepage ten years ago?
      
      <a href="https:&#x2F;&#x2F;endler.dev&#x2F;2020&#x2F;gravity&#x2F;">Continue reading</a>
    </p>
  </div>
</section>


 <footer>
    <div class="body">
        <div>
            <h2><a href="/about">About me</a></h2>
            <p>
                I'm a Backend Engineer running <i><a href="https://hello-rust.show/">Hello, Rust!</a></i>, a YouTube
                channel about the Rust
                programming language and <a href="https://analysis-tools.dev/">analysis-tools.dev</a>, an open platform for static analysis tools.
                On this blog, you'll mostly find articles about programming in
                <a href="/2017/yes/">Rust</a> and <a href="/2018/go-io-testing/">Golang</a> or developer tools like <a
                    href="/2017/makefiles/">make</a> and <a href="/2018/ten-years-of-vim/">Vim</a>. 
                    Don't know where to start? Check out the <a href="/archive">blog archive</a>.
            </p>
        </div>
        <div>
            <h2><a href="https://github.com/sponsors/mre/">Support</a></h2>
            <p>
                Maintaining this blog and my projects is a lot of work. With
                your help I can spend more time writing and developing. The
                best way to support me is to <a
                href="https://github.com/sponsors/mre/">sponsor me on
                GitHub</a>.  GitHub will even match sponsorships until October
                2020!  Alternatively, I also have a <a
                href="https://www.patreon.com/hellorust">Patreon</a> account.
                Thank you! ❤️
            </p>
        </div>
    </div>
</footer>
  </body>
</html>
