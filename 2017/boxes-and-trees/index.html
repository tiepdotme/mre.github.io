

<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      html,body,div,form,fieldset,legend,label,h1,h2{margin:0;padding:0}body{font-family:"Book Antiqua","Palatino Linotype",Palatino,"EB Garamond",serif;font-size:1.2em;line-height:1.58;color:#111;border-top:0.5em solid #c35}.container{display:grid;grid-template-columns:auto;margin:0 auto}header{font-size:0.8em;text-align:center;padding-top:30px}.bio{width:210px;margin:auto;padding:16px}main{padding:5px;margin-bottom:50px;max-width:650px}main article{margin-bottom:44px}main img,main video,iframe{max-width:100%;height:auto}.homepage h1{font-size:130%}h1,h2,h3,h4,h5,h6,th,td,caption{font-weight:400}h1{font-size:1.87em;margin-bottom:8px}h2{font-size:1.2em}main h2{margin-top:60px}h3{margin-top:0px;font-style:italic}header nav ul{display:inline-block;padding-left:0px;margin-top:0}header nav li{list-style:none;display:inline}.post-meta{font-style:italic;margin:0px;font-size:90%}.homepage .post-meta{font-size:80%}.btn{color:#111;background-color:#fafafa;display:inline-block;font-weight:500;border-radius:6px;border:1px solid rgba(27,31,35,0.15);text-decoration:none;box-shadow:0 1px 0 rgba(27,31,35,0.04),inset 0 1px 0 rgba(255,255,255,0.25);transition:background-color 0.2s cubic-bezier(0.3, 0, 0.5, 1);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;padding:5px 16px;white-space:nowrap}.btn-sm{padding:3px 12px;font-size:15px;line-height:20px}.btn-ico{margin-right:4px;vertical-align:text-bottom;transition:transform 0.15s cubic-bezier(0.2, 0, 0.13, 2);transform:scale(1);color:#ff1c76;fill:currentColor}.btn:hover .btn-ico{transform:scale(1.1)}pre,code{font-family:operator mono,sfmono-regular,Consolas,liberation mono,Menlo,Courier,monospace}pre{display:inline-grid;border-radius:6px;width:100%;padding:5px 0}code{font-size:0.8em;padding:2px}pre>code{overflow-x:auto;display:inline-block}:not(pre)>code{color:#111;background:#fafafa;border-radius:6px;box-shadow:0 1px 1px rgba(0,0,0,0.125)}blockquote{border-left:4px solid #9fd6fa;font-style:italic;margin:4px 10px;padding:0px 20px}::selection{background:black;color:white}a{color:#111;text-decoration:underline;text-decoration-color:#c35;text-decoration-thickness:2px;transition:text-decoration-color 200ms}a:hover{text-decoration-color:#111}.icon{height:24px;width:24px;opacity:0.4;float:left;margin:5px;background-repeat:no-repeat}.icon:hover{opacity:1;transition:opacity 200ms ease-in}figure{font-size:0.9em;font-style:italic;margin:40px 0 40px;padding:0;text-align:center;text-indent:0}figcaption{margin-top:10px}.post-links{list-style:none;padding:0}.comments{list-style:none;display:inline}#teaser{background:#c35;color:#f5b2c8}#teaser a,footer a{color:white}#teaser a::after{content:"\a0Â»"}footer{background:#234;color:#b9b9b9}#teaser,footer{display:flex;justify-content:center}#teaser .body,footer .body{max-width:800px;margin:40px auto;padding:20px}.field{padding:10px;font-size:0.8em;border:none;border:1px solid #b9b9b9}.autocomplete{position:relative;display:inline-block}.autocomplete input{border:1px solid #ddd;padding:10px 20px;border-radius:20px;width:150px;font-size:0.9em;box-shadow:0 1px 0px rgba(255,255,255,0.25)}input[type="submit"]{cursor:pointer;background-color:#b9b9b9}input:focus::placeholder{color:transparent}.autocomplete-items{position:absolute;left:0;top:38px;font-size:0.9em;line-height:1.5;width:100%}.autocomplete-items div{padding:10px;cursor:pointer;background-color:white;border:1px solid #ddd}.autocomplete-items div:hover,.autocomplete-active{background-color:#c35 !important;color:white}@media screen and (min-width: 600px){.container{justify-content:center;margin-top:40px;grid-template-columns:auto auto}header{position:sticky;top:0;height:100vh;box-sizing:border-box}main{padding:0px 30px;margin-top:20px}pre{padding:10px}.bio span:after{content:"Writes about Rust, engineering culture, and socks."}}@media not screen and (max-width: 800px){.searchicon{display:none}}@media screen and (max-width: 800px){#searchbox{display:none}#searchbox:target{display:block}.autocomplete{width:100%;font-size:1.1em}.autocomplete input{width:calc(100% - 100px);margin:20px 10px}.autocomplete-items{top:58px}}.info{padding:20px;margin:30px 0;background-color:lightyellow;border:4px solid peachpuff;position:relative;border-radius:6px}.logo_font{position:relative;width:165px;height:34px;margin:0 auto}.logo_font svg{position:absolute;top:0;left:0}@media (prefers-color-scheme: light){.logo_font_dark{display:none}}@media (prefers-color-scheme: dark){.logo_font_light{display:none}}@media (prefers-color-scheme: dark){body{background:#234;color:white;border-top:0.5em solid #ff1c76}.bio,.post-meta{color:#b9b9b9}a{color:white;text-decoration-color:#ff1c76}a:hover{text-decoration-color:white}.icon{filter:brightness(0) invert(1)}main img{background-color:white;border-radius:6px}table{width:100%}table a{border:none}th,td{border-bottom:1px solid #ddd}pre,code{-webkit-filter:invert(100%);filter:invert(100%)}.info{background:#141f2b;border-color:#555}.btn{background:#111;color:white}.autocomplete input,.autocomplete-items div{border:0;background:#141f2b;color:white}footer{background:#141f2b}}

    </style>
<title>Of Boxes and Trees - Smart Pointers in Rust | Matthias Endler</title>
<link rel="canonical" href="https://endler.dev/2017/boxes-and-trees/">

<meta property="og:title" content="Of Boxes and Trees - Smart Pointers in Rust | Matthias Endler" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Recently, I tried to implement a binary tree data structure in Rust.
Each binary tree has a root value, a left, and a right subtree.
I started from this Python implementation, which is quite straightforward.
" />
<meta property="og:url" content="https://endler.dev/2017/boxes-and-trees/" />
<meta property="og:image" content="https://endler.dev/default.png" />

<meta name="twitter:title" content="Of Boxes and Trees - Smart Pointers in Rust">
<meta name="twitter:description" content="Recently, I tried to implement a binary tree data structure in Rust.
Each binary tree has a root value, a left, and a right subtree.
I started from this Python implementation, which is quite straightforward.
">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@matthiasendler">
<meta name="twitter:creator" content="@matthiasendler">
<meta name="twitter:image" content="https://endler.dev/default.png">
    <link rel="canonical" href="https://endler.dev/2017/boxes-and-trees/" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/apple-touch-icon.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/favicon-32x32.png?v=m2llJQPQq8"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon-16x16.png?v=m2llJQPQq8"
    />
    <link
      rel="mask-icon"
      href="/safari-pinned-tab.svg?v=m2llJQPQq8"
      color="#5bbad5"
    />
    <link rel="shortcut icon" href="/favicon.ico?v=m2llJQPQq8" />
    <link href="/rss.xml" rel="alternate" type="application/rss+xml" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="author" content="Matthias Endler" />
    <meta
      name="description"
      content="Personal website of Matthias Endler, a Software Engineer interested in low-level programming and Backend development. Rust, Go"
    />
  </head>

  <body>
    <div class="container">
      <header>
        



<a href="/" aria-label="Go back to homepage">
  
  
  <div class="logo" style="width: 110px; margin: auto;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 456 456"><defs/><g letter-spacing="0" transform="translate(-167)" word-spacing="0"><circle cx="395" cy="228" r="220" fill="#fff" stroke="#000" stroke-width="16"/><path fill="#856800" fill-rule="evenodd" d="M468 266l-70 37-77-37z"/><path fill="#ffcb15" fill-rule="evenodd" d="M468 266l-70 31-77-31z"/><path d="M360 208a22 21 85 00-2 0 22 21 85 00-19 24 22 21 85 0023 19 22 21 85 0019-23 22 21 85 00-7-14 5 6 0 012 4 5 6 0 01-6 7 5 6 0 01-5-7 5 6 0 016-6 5 6 0 013 1 22 21 85 00-14-5zm71 1a22 21 85 00-2 0 22 21 85 00-19 23 22 21 85 0022 20 22 21 85 0019-24 22 21 85 00-20-19zm10 4a5 6 0 015 6 5 6 0 01-5 6 5 6 0 01-5-6 5 6 0 015-6z"/></g><path fill-rule="evenodd" d="M262 58c-4 9-12 19-19 24 1-8 2-16 1-22-4 8-12 18-20 24 2-7 2-15 1-21-7 13-15 24-29 28-70 20-131 113-152 213 11 28 29 53 51 73 8-158 45-267 112-208 10 9 16 13 20 13 5 0 10-4 21-13 67-59 105 50 112 208 22-20 40-45 51-73-20-95-77-184-144-209l-10-4c4-8 7-23 5-33z"/></svg>
  </div>
  <div class="logo_font">
    <div class="logo_font_dark">
    <?xml version="1.0" encoding="UTF-8"?>
<svg class="logo_font_dark" version="1.1" viewBox="0 0 786 139" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="m69.2 12.8v112h48.6v-12.2h-36v-31.8h29.8v-12.2h-29.8v-43.2h36v-12.2z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m213 12.8h-12.6v112h12.6c31 0 56.3-24.6 56.3-55.7 0-31.2-25.3-55.8-56.3-55.8zm0 12.2c24.2 0 43.7 19.5 43.7 43.7 0 24-19.5 43.5-43.7 43.5z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m279 12.8v112h48.6v-12.2h-36v-99.4z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m398 12.8v112h12.6v-28c4.96 0 10.1 0.16 15-0.64l19.2 28.6h14.9l-22.7-32.3c13.8-6.56 22.7-20.2 22.7-37.4 0-24.3-18.1-41.8-42.2-41.8zm12.6 71.4v-59.2h6.88c13.9 0 29.6 9.28 29.6 29.6 0 20.3-15.4 29.6-29.6 29.6z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m338 12.8v112h48.6v-12.2h-36v-31.8h29.8v-12.2h-29.8v-43.2h36v-12.2z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m191 13.4h-11.7v73.3l-48.5-73v113h11.8v-71.6l48.4 71.7z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g><g fill="#9f9f9f"><path d="m481 106c-4.79 0-8.7 3.9-8.7 8.7 0 4.79 3.9 8.7 8.7 8.7s8.7-3.9 8.7-8.7-3.9-8.7-8.7-8.7z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m502 12.7v110h14c30.9 0 55.7-24.3 55.7-55.2 0-30.7-24.8-55-55.7-55zm14 96.7v-83.2c23.1 0 41.7 18.6 41.7 41.5 0 23.1-18.6 41.7-41.7 41.7z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m643 12.7 37.1 111 37.1-111h-14.2l-22.9 69.4-23.1-69.4z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m583 13.1v111h48.4v-12.1h-35.8v-31.7h29.6v-12.1h-29.6v-43h35.8v-12.1z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g></svg>

    </div>
    <div class="logo_font_light">
    <?xml version="1.0" encoding="UTF-8"?>
<svg class="logo_font_light" version="1.1" viewBox="0 0 786.1 139.2" xmlns="http://www.w3.org/2000/svg"><g><path d="m69.212 12.818v111.53h48.644v-12.161h-36.003v-31.843h29.762v-12.161h-29.762v-43.203h36.003v-12.161z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m212.8 12.818h-12.641v111.53h12.641c31.042 0 56.324-24.642 56.324-55.684 0-31.203-25.282-55.845-56.324-55.845zm0 12.161c24.162 0 43.684 19.522 43.684 43.683 0 24.002-19.522 43.523-43.684 43.523z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m278.6 12.818v111.53h48.644v-12.161h-36.003v-99.368z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m397.99 12.818v111.53h12.641v-28.002c4.9603 0 10.081 0.15998 15.041-0.64l19.201 28.642h14.881l-22.722-32.323c13.761-6.5605 22.722-20.162 22.722-37.443 0-24.322-18.081-41.763-42.243-41.763zm12.641 71.366v-59.205h6.8805c13.921 0 29.602 9.2807 29.602 29.602 0 20.322-15.361 29.602-29.602 29.602z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m338.3 12.818v111.53h48.644v-12.161h-36.003v-31.843h29.762v-12.161h-29.762v-43.203h36.003v-12.161z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m190.51 13.387h-11.663v73.276l-48.474-72.993v112.67h11.784v-71.581l48.352 71.722z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g><g fill="#9f9f9f"><path d="m480.93 105.53c-4.7912 0-8.6953 3.904-8.6953 8.6953 0 4.7912 3.904 8.6953 8.6953 8.6953 4.7913 0 8.6953-3.904 8.6953-8.6953 0-4.7913-3.904-8.6953-8.6953-8.6953z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m502.04 12.723v110.2h14.019c30.877 0 55.721-24.311 55.721-55.189 0-30.7-24.844-55.011-55.721-55.011zm14.019 96.713v-83.226c23.069 0 41.702 18.633 41.702 41.524 0 23.069-18.633 41.702-41.702 41.702z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m642.71 12.723 37.088 110.73 37.088-110.73h-14.196l-22.892 69.385-23.069-69.385z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/><path d="m582.92 13.066v110.99h48.407v-12.102h-35.828v-31.688h29.618v-12.102h-29.618v-42.993h35.828v-12.102z" style="font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal"/></g></svg>

    </div>
  </div>
</a>

        <p class="bio">
          <span>
            Open-source maintainer, speaker, rebel.
          </span>
          <a href="/about">About me.</a>
        </p>
        





<nav>
    <ul>
        <li>
            <a class="icon" href="/" title="Go to homepage" aria-label="Go to homepage">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 61 58'><path stroke='#fff' stroke-linecap='square' stroke-width='.52916' d='M7 21v36h16V38h15v19h15V21z'/><path d='M61 26H0l15-13L30 0l15 13z'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://github.com/mre" title="Github" aria-label="Github">
                <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 578.3 578.3'><path d='M533 160c1-26-5-53-10-79-1-9-5-18-8-27-2-6-10-10-16-9l-12 3c-39 13-76 32-111 54-5 3-11 4-17 3l-41-5c-33-1-67 0-100 6-5 1-11 0-15-3-38-24-77-46-122-57-7-2-14-1-15 1l-3 6c-5 16-10 33-13 51-4 20-7 42-5 62 1 13-3 21-10 30-24 31-34 66-35 104-1 33 4 65 14 97 15 48 45 84 90 108 36 19 76 27 117 28h111c37 1 73-3 109-14 35-12 66-30 90-60 34-42 45-92 47-145 2-40-6-78-30-111a65 65 0 01-15-43zm-71 310c-16 13-35 20-55 25-39 9-79 11-119 10-39 1-78-1-116-10-28-7-54-18-72-42-29-39-36-112 11-152 12-11 26-17 41-18l53-3 133 3c20 0 40-5 60-4 18 2 38 5 54 12 28 12 42 37 47 66 7 43-2 83-37 113z'/><ellipse cx='390' cy='385.6' rx='42.1' ry='56.3'/><ellipse cx='189' cy='385.6' rx='42.1' ry='56.3'/></svg>
            </a>
        </li>
        <li>
            <a class="icon" href="https://twitter.com/matthiasendler" title="Twitter"
                aria-label="Twitter">
                <svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 612 612'><path fill='#010002' d='M612 116c-23 10-47 17-72 20 26-15 46-40 55-69-24 14-51 24-80 30a125 125 0 0 0-217 86c0 10 1 19 3 29-104-6-196-56-258-132a125 125 0 0 0 39 168c-21-1-40-6-57-16v2c0 61 43 111 100 123a127 127 0 0 1-56 2c16 50 62 86 117 87A252 252 0 0 1 0 498a355 355 0 0 0 550-301l-1-16c25-17 46-40 63-65z'/></svg> 
            </a>
        </li>
        <li>
            <a class="icon" href="/rss.xml" title="RSS feed"
                aria-label="RSS feed"><svg xmlns='http://www.w3.org/2000/svg' version='1' viewBox='0 0 1280 1280'><path d='M264 224l-1 79v79h8a660 660 0 0 1 438 174 665 665 0 0 1 218 492h156l1-26a820 820 0 0 0-715-792c-37-5-103-9-105-6z'/><path d='M263 504l-1 78 1 79 14 2a383 383 0 0 1 369 368l1 17h158v-19a536 536 0 0 0-98-293 546 546 0 0 0-444-232zM353 830a110 110 0 0 0-77 160 110 110 0 1 0 188-114c-5-7-23-25-30-29-25-16-54-22-81-17z'/></svg></a>
        </li>
        <li>
            <a class="searchicon icon" href="#searchbox" title="Search"
                aria-label="Search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90.1 90.1"><defs/><path d="M71.8 62.6a39.6 39.6 0 10-9.2 9.2L79 88.2a6.5 6.5 0 009.2-9.2zM13 39.6a26.5 26.5 0 1126.5 26.5 26.5 26.5 0 01-26.5-26.5z"/></svg>
            </a>
        </li>
    </ul>
</nav> 
<script type="module">async function lazyLoad(){await init("/tinysearch_engine_bg.wasm")}var loaded=!1;function autocomplete(e){var t;function n(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}(e),t>=e.length&&(t=0),t<0&&(t=e.length-1),e[t].classList.add("autocomplete-active")}function a(t){for(var n=document.getElementsByClassName("autocomplete-items"),a=0;a<n.length;a++)t!=n[a]&&t!=e&&n[a].parentNode.removeChild(n[a])}e.addEventListener("click",(function(e){loaded||(lazyLoad(),loaded=!0)})),e.addEventListener("input",(function(e){var n,o,i,c=this.value;if(a(),!c)return!1;t=-1,(n=document.createElement("DIV")).setAttribute("id",this.id+"autocomplete-list"),n.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(n);let r=search(c,3);for(i=0;i<r.length;i++){let e=r[i];(o=document.createElement("DIV")).innerHTML=e[0],o.addEventListener("click",(function(t){window.location.href=`${e[1]}?q=${encodeURIComponent(c)}`})),n.appendChild(o)}})),e.addEventListener("keydown",(function(e){var a=document.getElementById(this.id+"autocomplete-list");a&&(a=a.getElementsByTagName("div")),40==e.keyCode?(t++,n(a)):38==e.keyCode?(t--,n(a)):13==e.keyCode&&(e.preventDefault(),t>-1&&a&&a[t].click())})),document.addEventListener("click",(function(e){a(e.target)}))}let wasm;autocomplete(document.getElementById("tinysearch"));let WASM_VECTOR_LEN=0,cachedTextEncoder=new TextEncoder("utf-8");const encodeString="function"==typeof cachedTextEncoder.encodeInto?function(e,t){return cachedTextEncoder.encodeInto(e,t)}:function(e,t){const n=cachedTextEncoder.encode(e);return t.set(n),{read:e.length,written:n.length}};let cachegetUint8Memory=null;function getUint8Memory(){return null!==cachegetUint8Memory&&cachegetUint8Memory.buffer===wasm.memory.buffer||(cachegetUint8Memory=new Uint8Array(wasm.memory.buffer)),cachegetUint8Memory}function passStringToWasm(e){let t=e.length,n=wasm.__wbindgen_malloc(t);const a=getUint8Memory();let o=0;for(;o<t;o++){const t=e.charCodeAt(o);if(t>127)break;a[n+o]=t}if(o!==t){0!==o&&(e=e.slice(o)),n=wasm.__wbindgen_realloc(n,t,t=o+3*e.length);const a=getUint8Memory().subarray(n+o,n+t);o+=encodeString(e,a).written}return WASM_VECTOR_LEN=o,n}const heap=new Array(32);function getObject(e){return heap[e]}heap.fill(void 0),heap.push(void 0,null,!0,!1);let heap_next=heap.length;function dropObject(e){e<36||(heap[e]=heap_next,heap_next=e)}function takeObject(e){const t=getObject(e);return dropObject(e),t}export function search(e,t){return takeObject(wasm.search(passStringToWasm(e),WASM_VECTOR_LEN,t))}let cachedTextDecoder=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});function getStringFromWasm(e,t){return cachedTextDecoder.decode(getUint8Memory().subarray(e,e+t))}function addHeapObject(e){heap_next===heap.length&&heap.push(heap.length+1);const t=heap_next;return heap_next=heap[t],heap[t]=e,t}function init(e){let t;void 0===e&&(e=import.meta.url.replace(/\.js$/,"_bg.wasm"));const n={wbg:{}};if(n.wbg.__wbindgen_json_parse=function(e,t){return addHeapObject(JSON.parse(getStringFromWasm(e,t)))},"function"==typeof URL&&e instanceof URL||"string"==typeof e||"function"==typeof Request&&e instanceof Request){const a=fetch(e);t="function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,n).catch(e=>a.then(t=>{if("application/wasm"!=t.headers.get("Content-Type"))return console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e),t.arrayBuffer();throw e}).then(e=>WebAssembly.instantiate(e,n))):a.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,n))}else t=WebAssembly.instantiate(e,n).then(t=>t instanceof WebAssembly.Instance?{instance:t,module:e}:t);return t.then(({instance:e,module:t})=>(wasm=e.exports,init.__wbindgen_wasm_module=t,wasm))}export default init;</script>
<form id="searchbox" autocomplete="off">
    <div class="autocomplete">
        <input id="tinysearch" type="text" aria-label="Search through articles" placeholder="&#x1F50D; Search">
    </div>
</form>
      </header>

      <main>
        
<article>
  <p class='post-meta'>Published on 





12th of August, 2017


  </p>
  <h1>Of Boxes and Trees - Smart Pointers in Rust</h1>
  
  <p>Recently, I tried to implement a binary tree data structure in Rust.
Each binary tree has a root value, a left, and a right subtree.
I started from this Python implementation, which is quite straightforward.</p>
<span id="continue-reading"></span><pre style="background-color:#fafafa;">
<code><span style="color:#fa6e32;">class </span><span style="color:#399ee6;">Tree</span><span style="color:#61676c;">:
  </span><span style="color:#fa6e32;">def </span><span style="color:#f07171;">__init__</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">self</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">val</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">left</span><span style="color:#ed9366;">=</span><span style="color:#ff8f40;">None</span><span style="color:#61676ccc;">, </span><span style="color:#ff8f40;">right</span><span style="color:#ed9366;">=</span><span style="color:#ff8f40;">None</span><span style="color:#61676c;">):
    </span><span style="font-style:italic;color:#55b4d4;">self</span><span style="color:#ed9366;">.</span><span style="color:#61676c;">val </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">val
    </span><span style="font-style:italic;color:#55b4d4;">self</span><span style="color:#ed9366;">.</span><span style="color:#61676c;">left </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">left
    </span><span style="font-style:italic;color:#55b4d4;">self</span><span style="color:#ed9366;">.</span><span style="color:#61676c;">right </span><span style="color:#ed9366;">= </span><span style="color:#61676c;">right
</span></code></pre>
<p>This allows us to declare a fancy tree object like this:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">t </span><span style="color:#ed9366;">= </span><span style="color:#f29718;">Tree</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">15</span><span style="color:#61676ccc;">,
      </span><span style="color:#f29718;">Tree</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">12</span><span style="color:#61676ccc;">,
           </span><span style="color:#ff8f40;">None</span><span style="color:#61676ccc;">,
           </span><span style="color:#f29718;">Tree</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">13</span><span style="color:#61676c;">))</span><span style="color:#61676ccc;">,
      </span><span style="color:#f29718;">Tree</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">22</span><span style="color:#61676ccc;">,
           </span><span style="color:#f29718;">Tree</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">18</span><span style="color:#61676c;">)</span><span style="color:#61676ccc;">,
           </span><span style="color:#f29718;">Tree</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">100</span><span style="color:#61676c;">)))
</span></code></pre>
<p>And the result can be visualized beautifully.<br />
(Yes I've drawn that myself.)</p>
<figure>
        <img src=".&#x2F;tree.svg" 
        loading="lazy"
            alt="A binary search tree representing our data structure"
        />
    <figcaption>
        A binary search tree representing our data structure
    </figcaption>
</figure>
<p>Porting that code to Rust turned out to be a little... challenging.
My first attempt looked quite innocuous.</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#fa6e32;">struct </span><span style="color:#399ee6;">Tree </span><span style="color:#61676c;">{
  root</span><span style="color:#61676ccc;">: </span><span style="color:#fa6e32;">i64</span><span style="color:#61676c;">,
  left</span><span style="color:#61676ccc;">:</span><span style="color:#61676c;"> Tree,
  right</span><span style="color:#61676ccc;">:</span><span style="color:#61676c;"> Tree,
}
</span></code></pre>
<p>That's pretty much a one-to-one translation of the Python definition â€” but <a href="https://www.youtube.com/watch?v=0n_Ty_72Qds"><strong><code>rustc</code></strong> <strong>says no</strong></a>.</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">error[</span><span style="color:#ff8f40;">E0072</span><span style="color:#61676c;">]</span><span style="color:#61676ccc;">:</span><span style="color:#61676c;"> recursive </span><span style="color:#fa6e32;">type</span><span style="color:#61676c;"> `Tree` has infinite size
 </span><span style="color:#ed9366;">-</span><span style="color:#61676ccc;">-&gt;</span><span style="color:#61676c;"> src</span><span style="color:#ed9366;">/</span><span style="color:#61676c;">main</span><span style="color:#ed9366;">.</span><span style="color:#61676c;">rs</span><span style="color:#61676ccc;">:</span><span style="color:#ff8f40;">1</span><span style="color:#61676ccc;">:</span><span style="color:#ff8f40;">1
  </span><span style="color:#ed9366;">|
</span><span style="color:#ff8f40;">1 </span><span style="color:#ed9366;">| </span><span style="color:#fa6e32;">struct </span><span style="color:#399ee6;">Tree </span><span style="color:#61676c;">{
  | ^^^^^^^^^^^ recursive type has infinite size
  |
  = help</span><span style="color:#61676ccc;">:</span><span style="color:#61676c;"> insert indirection (e.g., a `Box`, `Rc`, or `</span><span style="color:#ed9366;">&amp;</span><span style="color:#61676c;">`) at some point to make `Tree` representable
</span></code></pre>
<p>Coming from memory-managed languages (like Python, PHP, or Ruby), I was confused by this.
The problem is easy to understand, though.
Computers have a limited amount of memory.
It's the compiler's job to find out how much memory to allocate for each item.</p>
<p>In our case, it infers the following:</p>
<p>A tree is a structure containing an <code>i64</code>, and two trees. Each of these trees is a structure containing an <code>i64</code>, and two trees. Each of these...<br />
<a href="https://stackoverflow.com/questions/25296195/why-are-recursive-struct-types-illegal-in-rust/25296420#25296420">You get the idea.</a></p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">Tree { </span><span style="color:#fa6e32;">i64</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> Tree</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> Tree }
Tree { </span><span style="color:#fa6e32;">i64</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> Tree { </span><span style="color:#ed9366;">... </span><span style="color:#61676c;">}</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;"> Tree { </span><span style="color:#ed9366;">... </span><span style="color:#61676c;">} }
</span><span style="font-style:italic;color:#abb0b6;">// The next expansion won&#39;t fit on the page anymore
</span></code></pre>
<p>Since we don't know how many subtrees our tree will have, there is no way to tell how much memory we need to allocate up front. We'll only know at runtime!</p>
<p>Rust tells us how to fix that: by inserting an <em>indirection</em> like <code>Box</code>, <code>Rc</code>, or <code>&amp;</code>.
These are different &quot;pointer types&quot; in Rust. They all point to places in memory. So, instead of knowing the total size of our tree structure, we just know the <em>point</em> in memory where the tree is located. But that's enough to define the tree structure.
These pointer types allow us to do that safely and without manual memory management.
They all offer different guarantees and you should <a href="https://endler.dev/2017/why-type-systems-matter/">choose the one that fits your requirements best</a>.</p>
<ul>
<li>
<p><code>&amp;</code> is called a <code>borrow</code> in Rust speech. It's the most common of the three. It's a reference to some place in memory, but it does not <strong>own</strong> the data it points to. As such, the lifetime of the borrow depends on its owner.
Therefore we would need to add lifetime parameters here. This can make it tedious to use.</p>
<pre style="background-color:#fafafa;">
<code>```rust
struct Tree&lt;'a&gt; {
  root: i64,
  left: &amp;'a Tree&lt;'a&gt;,
  right: &amp;'a Tree&lt;'a&gt;,
}
```
</code></pre></li>
<li>
<p><a href="https://doc.rust-lang.org/std/boxed/struct.Box.html"><code>Box</code></a> is a <strong>smart pointer</strong> with zero runtime overhead. It owns the data it points to.
We call it smart because when it goes out of scope, it will first drop the data it points to and then itself. No manual memory management required.</p>
<pre style="background-color:#fafafa;">
<code>```rust
struct Tree {
  root: i64,
  left: Box&lt;Tree&gt;,
  right: Box&lt;Tree&gt;,
}
```
</code></pre></li>
<li>
<p><a href="https://doc.rust-lang.org/std/rc/struct.Rc.html"><code>Rc</code></a> is another smart pointer. It's short for &quot;reference-counting&quot;. It keeps track of the number of references to a data structure. As soon as the number of references is down to zero, it cleans up after itself.
Choose <code>Rc</code> if you need to have multiple owners of the same data in one thread.
For multithreading, there's also <a href="https://doc.rust-lang.org/std/sync/struct.Arc.html"><code>Arc</code></a> (atomic reference count).</p>
<pre style="background-color:#fafafa;">
<code>```rust
struct Tree {
  root: i64,
  left: Rc&lt;Tree&gt;,
  right: Rc&lt;Tree&gt;,
}
```
</code></pre></li>
</ul>
<h2 id="putting-the-tree-into-a-box">Putting the tree into a box</h2>
<p>All three options are totally valid. Which one you should choose, depends on your use-case.
A rule of thumb is to keep it simple.
In my case, I chose to use a <code>Box</code>, because I did not need any special guarantees.</p>
<h2 id="making-subtrees-optional">Making subtrees optional</h2>
<p>The next problem I faced was that I could not instantiate a tree structure.
The left and right subtree have the type <code>Box&lt;Tree&gt;</code>, but at some
point I would need an empty subtree.</p>
<p>In the Python example, I used <code>None</code> to signal the end of my data structure.
Thanks to Rust's <a href="https://doc.rust-lang.org/std/option/"><code>Option</code></a> type we can do the same:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#fa6e32;">struct </span><span style="color:#399ee6;">Tree </span><span style="color:#61676c;">{
  root</span><span style="color:#61676ccc;">: </span><span style="color:#fa6e32;">i64</span><span style="color:#61676c;">,
  left</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">Option</span><span style="color:#61676c;">&lt;</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#61676c;">&lt;Tree&gt;&gt;,
  right</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">Option</span><span style="color:#61676c;">&lt;</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#61676c;">&lt;Tree&gt;&gt;,
}
</span></code></pre>
<p>After all of this, we can create our first tree:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">Tree {
    root</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">15</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
    left</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">Some</span><span style="color:#61676c;">(</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(Tree {
            root</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">12</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
            left</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">None</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
            right</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">Some</span><span style="color:#61676c;">(</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(Tree {
                    root</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">13</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
                    left</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">None</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
                    right</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">None</span><span style="color:#61676ccc;">,
            </span><span style="color:#61676c;">}))</span><span style="color:#61676ccc;">,
    </span><span style="color:#61676c;">}))</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
    right</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">Some</span><span style="color:#61676c;">(</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(Tree {
            root</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">22</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
            left</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">Some</span><span style="color:#61676c;">(</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(Tree {
                    root</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">18</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
                    left</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">None</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
                    right</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">None</span><span style="color:#61676ccc;">,
            </span><span style="color:#61676c;">}))</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
            right</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">Some</span><span style="color:#61676c;">(</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(Tree {
                    root</span><span style="color:#61676ccc;">: </span><span style="color:#ff8f40;">100</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
                    left</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">None</span><span style="color:#61676ccc;">,</span><span style="color:#61676c;">
                    right</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">None</span><span style="color:#61676ccc;">,
            </span><span style="color:#61676c;">}))</span><span style="color:#61676ccc;">,
    </span><span style="color:#61676c;">}))</span><span style="color:#61676ccc;">,
</span><span style="color:#61676c;">}</span><span style="color:#61676ccc;">;
</span></code></pre>
<p>Depending on your point of view, you might say this is either verbose or explicit.
Compared to the Python version, it looked a bit too cluttered.</p>
<p>Can we do better?
<a href="https://github.com/deepinthebuild">Chris McDonald</a> helped me to come up with the following representation:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676c;">Tree</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(</span><span style="color:#ff8f40;">15</span><span style="color:#61676c;">)
  </span><span style="color:#ed9366;">.</span><span style="color:#f07171;">left</span><span style="color:#61676c;">(
    Tree</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(</span><span style="color:#ff8f40;">12</span><span style="color:#61676c;">)
      </span><span style="color:#ed9366;">.</span><span style="color:#f07171;">right</span><span style="color:#61676c;">(Tree</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(</span><span style="color:#ff8f40;">13</span><span style="color:#61676c;">))
  )
  </span><span style="color:#ed9366;">.</span><span style="color:#f07171;">right</span><span style="color:#61676c;">(
    Tree</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(</span><span style="color:#ff8f40;">22</span><span style="color:#61676c;">)
      </span><span style="color:#ed9366;">.</span><span style="color:#f07171;">left</span><span style="color:#61676c;">(Tree</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(</span><span style="color:#ff8f40;">18</span><span style="color:#61676c;">))
      </span><span style="color:#ed9366;">.</span><span style="color:#f07171;">right</span><span style="color:#61676c;">(Tree</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(</span><span style="color:#ff8f40;">100</span><span style="color:#61676c;">))
  )</span><span style="color:#61676ccc;">;
</span></code></pre>
<p>To me, this is much easier on the eye.<br />
Here's the full tree implementation that makes this possible:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#61676ccc;">#</span><span style="color:#61676c;">[</span><span style="color:#f29718;">derive</span><span style="color:#61676c;">(Default)]
</span><span style="color:#fa6e32;">struct </span><span style="color:#399ee6;">Tree </span><span style="color:#61676c;">{
  root</span><span style="color:#61676ccc;">: </span><span style="color:#fa6e32;">i64</span><span style="color:#61676c;">,
  left</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">Option</span><span style="color:#61676c;">&lt;</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#61676c;">&lt;Tree&gt;&gt;,
  right</span><span style="color:#61676ccc;">: </span><span style="font-style:italic;color:#55b4d4;">Option</span><span style="color:#61676c;">&lt;</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#61676c;">&lt;Tree&gt;&gt;,
}

</span><span style="color:#fa6e32;">impl </span><span style="color:#399ee6;">Tree </span><span style="color:#61676c;">{
  </span><span style="color:#fa6e32;">fn </span><span style="color:#f29718;">new</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">root</span><span style="color:#61676ccc;">: </span><span style="color:#fa6e32;">i64</span><span style="color:#61676c;">) </span><span style="color:#61676ccc;">-&gt;</span><span style="color:#61676c;"> Tree {
    Tree {
      root</span><span style="color:#61676ccc;">:</span><span style="color:#61676c;"> root</span><span style="color:#61676ccc;">,
      </span><span style="color:#ed9366;">..</span><span style="font-style:italic;color:#55b4d4;">Default</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">default()
    }
  }

  </span><span style="color:#fa6e32;">fn </span><span style="color:#f29718;">left</span><span style="color:#61676c;">(</span><span style="color:#fa6e32;">mut </span><span style="color:#ff8f40;">self</span><span style="color:#61676c;">, </span><span style="color:#ff8f40;">leaf</span><span style="color:#61676ccc;">:</span><span style="color:#61676c;"> Tree) </span><span style="color:#61676ccc;">-&gt; </span><span style="color:#fa6e32;">Self </span><span style="color:#61676c;">{
    </span><span style="font-style:italic;color:#55b4d4;">self</span><span style="color:#ed9366;">.</span><span style="color:#61676c;">left </span><span style="color:#ed9366;">= </span><span style="font-style:italic;color:#55b4d4;">Some</span><span style="color:#61676c;">(</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(leaf))</span><span style="color:#61676ccc;">;
    </span><span style="font-style:italic;color:#55b4d4;">self
  </span><span style="color:#61676c;">}

  </span><span style="color:#fa6e32;">fn </span><span style="color:#f29718;">right</span><span style="color:#61676c;">(</span><span style="color:#fa6e32;">mut </span><span style="color:#ff8f40;">self</span><span style="color:#61676c;">, </span><span style="color:#ff8f40;">leaf</span><span style="color:#61676ccc;">:</span><span style="color:#61676c;"> Tree) </span><span style="color:#61676ccc;">-&gt; </span><span style="color:#fa6e32;">Self </span><span style="color:#61676c;">{
    </span><span style="font-style:italic;color:#55b4d4;">self</span><span style="color:#ed9366;">.</span><span style="color:#61676c;">right </span><span style="color:#ed9366;">= </span><span style="font-style:italic;color:#55b4d4;">Some</span><span style="color:#61676c;">(</span><span style="font-style:italic;color:#55b4d4;">Box</span><span style="color:#ed9366;">::</span><span style="color:#61676c;">new(leaf))</span><span style="color:#61676ccc;">;
    </span><span style="font-style:italic;color:#55b4d4;">self
  </span><span style="color:#61676c;">}
}
</span></code></pre>
<p><strong>Update:</strong> <a href="https://twitter.com/fungos">Danny Grein</a> mentioned on Twitter, that
we can support the following syntax by implementing <a href="https://play.rust-lang.org/?gist=1454d2bfdacf0c83434a3095b0adcb5d&amp;version=stable"><code>From&lt;i64&gt; for Tree</code></a>:</p>
<pre style="background-color:#fafafa;">
<code><span style="color:#f07171;">root</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">15</span><span style="color:#61676c;">)
  </span><span style="color:#ed9366;">.</span><span style="color:#f07171;">left</span><span style="color:#61676c;">(</span><span style="color:#f07171;">root</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">12</span><span style="color:#61676c;">)</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">right</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">13</span><span style="color:#61676c;">))
  </span><span style="color:#ed9366;">.</span><span style="color:#f07171;">right</span><span style="color:#61676c;">(</span><span style="color:#f07171;">root</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">22</span><span style="color:#61676c;">)</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">left</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">18</span><span style="color:#61676c;">)</span><span style="color:#ed9366;">.</span><span style="color:#f07171;">right</span><span style="color:#61676c;">(</span><span style="color:#ff8f40;">100</span><span style="color:#61676c;">))</span><span style="color:#61676ccc;">;
</span></code></pre><h2 id="why-did-it-work-in-python">Why did it work in Python?</h2>
<p>Now you might be wondering, why our tree implementation worked so flawlessly in Python.
The reason is that Python dynamically allocates memory for the tree object at runtime.
Also, it wraps everything inside a <a href="https://pythonextensionpatterns.readthedocs.io/en/latest/refcount.html">PyObject, which is kind of similar to <code>Rc</code> from above</a>
â€” a reference counted smart pointer.</p>
<p>Rust is more explicit here. It gives us more flexibility to express our needs.
Then again, we need to know about all the possible alternatives to make good use of them.
If you can, then stay away from smart pointers and stick to simple borrows.<br />
If that's not possible, as seen above, choose the least invasive one for your
use-case. The <a href="https://doc.rust-lang.org/book/second-edition/ch15-00-smart-pointers.html">Rust documentation</a> is a good starting point here.
Also, read <a href="https://rust-leipzig.github.io/architecture/2016/12/20/idiomatic-trees-in-rust/">&quot;Idiomatic tree and graph-like structures in Rust&quot;</a> for some clever use of allocators.</p>


  <ul class='post-links'>
    
    <li>
      
ðŸ’¬ Comments on

<a href="https:&#x2F;&#x2F;www.reddit.com&#x2F;r&#x2F;rust&#x2F;comments&#x2F;6tkyz3&#x2F;of_boxes_and_trees_smart_pointers_in_rust&#x2F;">Reddit</a>.


    </li>
    
    
  </ul>
  <div class="info">
  <p>
    Thanks for reading! If you would like to receive future posts automatically,
    you can subscribe via email or <a href="/rss.xml">RSS</a>.
  </p>
  <form
    action="https://tinyletter.com/mre"
    method="post"
    target="popupwindow"
    onsubmit="window.open('https://tinyletter.com/mre', 'popupwindow', 'scrollbars=yes,width=800,height=600'); return true"
  >
    <p>
      <input
        class="field"
        type="email"
        name="email"
        id="tlemail"
        placeholder="E-Mail address"
        aria-label="E-mail address"
      />
      <input type="hidden" value="1" name="embed" /><input
        class="field submit"
        type="submit"
        value="Subscribe"
      />
    </p>
  </form>
  <p>
    Want to read more stories?
    <a
      class="btn btn-sm"
      aria-label="Sponsor Matthias on Github"
      href="https://github.com/sponsors/mre/"
    >
      <svg
        class="btn-ico"
        viewBox="0 0 16 16"
        version="1.1"
        width="16"
        height="16"
        aria-hidden="true"
      >
        <path
          fill-rule="evenodd"
          d="M4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.565 20.565 0 008 13.393a20.561 20.561 0 003.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.75.75 0 01-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5zM8 14.25l-.345.666-.002-.001-.006-.003-.018-.01a7.643 7.643 0 01-.31-.17 22.075 22.075 0 01-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.08 22.08 0 01-3.744 2.584l-.018.01-.006.003h-.002L8 14.25zm0 0l.345.666a.752.752 0 01-.69 0L8 14.25z"
        ></path></svg
      ><span>Sponsor</span></a
    >
  </p>
</div>

  

</article>

        </div>
      </main>
    </div>
    

<section id="teaser">
  <div class="body">
    <h2><a href="https:&#x2F;&#x2F;endler.dev&#x2F;2017&#x2F;why-type-systems-matter&#x2F;">Why Type Systems Matter</a></h2>
    <p>
      
        I've written most of my code in dynamically typed languages such as Python or PHP. But ever since dabbling with Rust, I've developed a passion for static type systems.
It began to feel very natural to me; like a totally new way to express myself.

      
      <a href="https:&#x2F;&#x2F;endler.dev&#x2F;2017&#x2F;why-type-systems-matter&#x2F;">Continue reading</a>
    </p>
  </div>
</section>


 <footer>
    <div class="body">
        <div>
            <h2><a href="/about">About me</a></h2>
            <p>
                I'm a Backend Engineer running <i><a href="https://hello-rust.show/">Hello, Rust!</a></i>, a YouTube
                channel about the Rust
                programming language and <a href="https://analysis-tools.dev/">analysis-tools.dev</a>, an open platform for static analysis tools.
                On this blog, you'll mostly find articles about programming in
                <a href="/2017/yes/">Rust</a> and <a href="/2018/go-io-testing/">Golang</a> or developer tools like <a
                    href="/2017/makefiles/">make</a> and <a href="/2018/ten-years-of-vim/">Vim</a>. 
                    Don't know where to start? Check out the <a href="/archive">blog archive</a>.
            </p>
        </div>
        <div>
            <h2><a href="https://github.com/sponsors/mre/">Support</a></h2>
            <p>
                Maintaining this blog and my projects is a lot of work. With
                your help I can spend more time writing and developing. The
                best way to support me is to <a
                href="https://github.com/sponsors/mre/">sponsor me on
                GitHub</a>.  GitHub will even match sponsorships until October
                2020!  Alternatively, I also have a <a
                href="https://www.patreon.com/hellorust">Patreon</a> account.
                Thank you! â¤ï¸
            </p>
        </div>
    </div>
</footer>
  </body>
</html>
